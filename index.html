<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Merge 100 - Ultimate Edition</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    min-height: 100vh;
    overflow-x: hidden;
    color: white;
}
body.light-theme {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #333;
}
.game-container { max-width: 1400px; margin: 0 auto; padding: 20px; }
.header { text-align: center; margin-bottom: 30px; }
h1 {
    font-size: 3em;
    text-shadow: 0 0 20px rgba(255,255,255,0.5);
    margin-bottom: 10px;
    background: linear-gradient(45deg, #ffd700, #ff6b6b, #4ecdc4);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
.player-level {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    background: linear-gradient(45deg, #ff6b6b, #ffd700);
    padding: 10px 25px;
    border-radius: 50px;
    font-weight: bold;
    margin-bottom: 15px;
}
.player-level-bar { width: 150px; height: 10px; background: rgba(0,0,0,0.3); border-radius: 5px; overflow: hidden; }
.player-level-fill { height: 100%; background: #fff; transition: width 0.3s; }
.stats { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 20px; }
.stat-box {
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    padding: 15px 25px;
    border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.2);
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    min-width: 120px;
}
.stat-box:hover { transform: translateY(-5px); }
.stat-label { font-size: 0.85em; opacity: 0.8; text-transform: uppercase; }
.stat-value { font-size: 1.8em; font-weight: bold; margin-top: 5px; }
.coins { color: #ffd700; }
.diamonds { color: #00ffff; }
.level { color: #ff6b6b; }
.offline-income {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(135deg, #667eea, #764ba2);
    padding: 40px;
    border-radius: 30px;
    text-align: center;
    z-index: 5000;
    display: none;
    border: 3px solid #ffd700;
}
.offline-income.active { display: block; }
.game-area {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
    gap: 12px;
    max-width: 900px;
    margin: 0 auto 30px;
    padding: 20px;
    background: rgba(0,0,0,0.2);
    border-radius: 20px;
}
.item {
    aspect-ratio: 1;
    border-radius: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: bold;
    font-size: 1.1em;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    border: 2px solid rgba(255,255,255,0.3);
}
.item:hover { transform: scale(1.1) rotate(3deg); z-index: 10; }
.item.selected { animation: pulse 0.5s infinite alternate; border-color: #fff; box-shadow: 0 0 30px rgba(255,255,255,0.6); }
.item.golden { border-color: #ffd700; box-shadow: 0 0 20px rgba(255,215,0,0.5); }
.item-level { font-size: 1.3em; }
.item-icon { font-size: 1.8em; margin-bottom: 3px; }
.controls { text-align: center; margin-bottom: 20px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
.btn {
    background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
    padding: 12px 30px;
    font-size: 1em;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: bold;
}
.btn:hover { transform: translateY(-3px); }
.btn:disabled { opacity: 0.5; cursor: not-allowed; }
.btn-secondary { background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%); }
.btn-success { background: linear-gradient(45deg, #11998e 0%, #38ef7d 100%); }
.btn-gold { background: linear-gradient(45deg, #ffd700, #ffaa00); color: #333; }
.btn-boss { background: linear-gradient(45deg, #ff0000, #8b0000); animation: bossPulse 2s infinite; }
.panel {
    background: rgba(255,255,255,0.05);
    border-radius: 20px;
    padding: 20px;
    margin-top: 20px;
    backdrop-filter: blur(10px);
}
.panel h2 { text-align: center; margin-bottom: 15px; }
.shop h2 { color: #ffd700; }
.quests-panel h2 { color: #4ecdc4; }
.skills-panel h2 { color: #ff6b6b; }
.pets-panel h2 { color: #ff9500; }
.shop-items, .chests-grid, .skins-grid, .pets-grid {
    display: flex;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
}
.shop-item, .chest-item, .skin-item, .pet-item {
    background: rgba(255,255,255,0.1);
    padding: 15px;
    border-radius: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    border: 2px solid transparent;
    min-width: 140px;
}
.shop-item:hover, .chest-item:hover, .skin-item:hover, .pet-item:hover {
    border-color: #ffd700;
    transform: translateY(-5px);
}
.skin-item.equipped { border-color: #00ff00; }
.pet-item.active { border-color: #ff9500; }
.quest { display: flex; align-items: center; padding: 12px; margin: 8px 0; background: rgba(0,0,0,0.2); border-radius: 12px; }
.quest.completed { background: rgba(78,205,196,0.2); border: 1px solid #4ecdc4; }
.quest-icon { font-size: 2em; margin-right: 15px; }
.quest-info { flex: 1; }
.quest-bar { width: 100%; height: 8px; background: rgba(0,0,0,0.3); border-radius: 4px; margin-top: 5px; overflow: hidden; }
.quest-bar-fill { height: 100%; background: linear-gradient(90deg, #4ecdc4, #44a3aa); }
.skills-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
.skill { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 15px; text-align: center; }
.skill-icon { font-size: 2.5em; margin-bottom: 10px; }
.pet-icon { font-size: 3em; margin-bottom: 10px; }
.boss-health-bar { width: 100%; height: 30px; background: rgba(0,0,0,0.5); border-radius: 15px; overflow: hidden; margin: 15px 0; border: 2px solid #ff0000; }
.boss-health-fill { height: 100%; background: linear-gradient(90deg, #ff0000, #8b0000); }
.boss-timer { text-align: center; font-size: 1.5em; color: #ff0000; }
.chest-item { position: relative; overflow: hidden; }
.autoclicker-panel {
    position: fixed;
    bottom: 20px; left: 20px;
    background: rgba(0,0,0,0.8);
    padding: 15px;
    border-radius: 15px;
    z-index: 100;
}
.autoclicker-toggle {
    width: 50px; height: 25px;
    background: #333;
    border-radius: 25px;
    position: relative;
    cursor: pointer;
}
.autoclicker-toggle.active { background: #00ff00; }
.autoclicker-toggle::after {
    content: '';
    position: absolute;
    width: 20px; height: 20px;
    background: white;
    border-radius: 50%;
    top: 2.5px; left: 2.5px;
    transition: transform 0.3s;
}
.autoclicker-toggle.active::after { transform: translateX(25px); }
.memory-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    max-width: 300px;
    margin: 20px auto;
}
.memory-card {
    aspect-ratio: 1;
    background: linear-gradient(45deg, #667eea, #764ba2);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2em;
    cursor: pointer;
}
.memory-card.flipped { background: #fff; }
.memory-card.matched { background: #00ff00; }
.floating-text {
    position: fixed;
    pointer-events: none;
    font-weight: bold;
    font-size: 1.5em;
    animation: floatUp 1s ease-out forwards;
    z-index: 1000;
}
.victory-screen, .defeat-screen {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.9);
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 2000;
}
.victory-screen.active, .defeat-screen.active { display: flex; }
.victory-title {
    font-size: 4em;
    background: linear-gradient(45deg, #ffd700, #ff6b6b, #4ecdc4, #ffd700);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: gradient 3s ease infinite;
}
.combo-display {
    position: fixed;
    top: 100px; right: 20px;
    background: linear-gradient(45deg, #ff9500, #ff6b6b);
    padding: 15px 25px;
    border-radius: 15px;
    font-weight: bold;
    display: none;
    z-index: 100;
}
.combo-display.active { display: block; }
.settings-panel {
    position: fixed;
    top: 20px; right: 20px;
    z-index: 100;
    display: flex;
    gap: 10px;
}
.settings-btn {
    background: rgba(255,255,255,0.1);
    border: none;
    color: white;
    font-size: 1.3em;
    width: 45px; height: 45px;
    border-radius: 50%;
    cursor: pointer;
}
.modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 3000;
}
.modal-overlay.active { display: flex; }
.modal {
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    padding: 30px;
    border-radius: 20px;
    max-width: 500px;
    width: 90%;
}
.modal h2 { text-align: center; color: #ffd700; }
@keyframes pulse { from { transform: scale(1); } to { transform: scale(1.05); } }
@keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
@keyframes gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
@keyframes bossPulse { 0%, 100% { box-shadow: 0 0 20px rgba(255,0,0,0.5); } 50% { box-shadow: 0 0 40px rgba(255,0,0,0.8); } }
.info-panel {
    text-align: center;
    margin-bottom: 20px;
    padding: 15px;
    background: rgba(255,255,255,0.05);
    border-radius: 15px;
}
.toast {
    position: fixed;
    bottom: 20px; left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.9);
    color: white;
    padding: 15px 30px;
    border-radius: 50px;
    z-index: 3000;
    border: 2px solid #ffd700;
}
.tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
.tab-btn {
    background: rgba(255,255,255,0.1);
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
    cursor: pointer;
}
.tab-btn.active { background: rgba(255,255,255,0.3); }
.tab-content { display: none; }
.tab-content.active { display: block; }
@media (max-width: 768px) {
    h1 { font-size: 1.8em; }
    .game-area { grid-template-columns: repeat(3, 1fr); }
    .btn { padding: 10px 20px; font-size: 0.85em; }
}
</style>
</head>
<body>

    <div class="offline-income" id="offline-income">
        <h2>üí§ –ü–æ–∫–∞ —Ç–µ–±—è –Ω–µ –±—ã–ª–æ</h2>
        <p>–¢—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª <span id="offline-time">0</span></p>
        <div class="amount">+<span id="offline-amount">0</span> üí∞</div>
        <button class="btn btn-gold" onclick="game.claimOffline()">üíé –ó–∞–±—Ä–∞—Ç—å (x2)</button>
        <button class="btn" onclick="game.skipOffline()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
    </div>
    <div class="settings-panel">
        <button class="settings-btn" onclick="game.toggleSound()">üîä</button>
        <button class="settings-btn" onclick="game.toggleTheme()">üåô</button>
        <button class="settings-btn" onclick="game.showExportModal()">üíæ</button>
        <button class="settings-btn" onclick="game.resetGame()">üîÑ</button>
    </div>
    <div class="combo-display" id="combo-display">
        üî• COMBO x<span id="combo-count">2</span>! +<span id="combo-bonus">50</span>%
    </div>
    <div class="game-container">
        <div class="header">
            <h1>üî• MERGE 100 üî•</h1>
            <div class="player-level">
                <span>üë§ –£—Ä–æ–≤–µ–Ω—å <span id="player-level">1</span></span>
                <div class="player-level-bar"><div class="player-level-fill" id="player-xp-bar" style="width: 0%"></div></div>
                <span id="player-xp-text">0/100 XP</span>
            </div>
            <p>–°–æ–µ–¥–∏–Ω—è–π, –ø—Ä–æ–∫–∞—á–∏–≤–∞–π, –ø–æ–±–µ–∂–¥–∞–π!</p>
        </div>
        <div class="stats">
            <div class="stat-box"><div class="stat-label">üí∞ –ú–æ–Ω–µ—Ç—ã</div><div class="stat-value coins" id="coins">10</div></div>
            <div class="stat-box"><div class="stat-label">üíé –ê–ª–º–∞–∑—ã</div><div class="stat-value diamonds" id="diamonds">0</div></div>
            <div class="stat-box"><div class="stat-label">üèÜ –ú–∞–∫—Å. –£—Ä–æ–≤–µ–Ω—å</div><div class="stat-value level" id="max-level">1</div></div>
            <div class="stat-box" id="prestige-box" style="display: none;"><div class="stat-label">üíé –ü—Ä–µ—Å—Ç–∏–∂</div><div class="stat-value prestige" id="prestige-points">0</div></div>
        </div>
        <div class="info-panel">
            üí∞ –î–æ—Ö–æ–¥: <span id="income-display">1</span>/—Å–µ–∫ | üíé –ê–ª–º–∞–∑—ã: <span id="diamond-income">0</span>/–º–∏–Ω
            <span id="prestige-bonus" style="color: #ff00ff; display: none;"> | –ü—Ä–µ—Å—Ç–∏–∂: x<span id="prestige-multiplier">1</span></span>
            <br><small>üí° –í—ã–±–µ—Ä–∏ 3+ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –¥–ª—è –°–£–ü–ï–†-—Å–ª–∏—è–Ω–∏—è!</small>
        </div>
        <div class="controls">
            <button class="btn" onclick="game.spawnItem()">üé≤ –°–æ–∑–¥–∞—Ç—å (10üí∞)</button>
            <button class="btn btn-secondary" onclick="game.buyAutoMerge()">ü§ñ –ê–≤—Ç–æ (<span id="auto-merge-cost">1000</span>)</button>
            <button class="btn btn-success" id="turbo-btn" onclick="game.activateTurbo()">‚ö° –¢—É—Ä–±–æ (<span id="turbo-cost">5000</span>)</button>
            <button class="btn btn-gold" onclick="game.activateGoldenMode()">‚ú® –ó–æ–ª–æ—Ç–æ–π (<span id="golden-cost">10000</span>)</button>
            <button class="btn btn-boss" onclick="game.startBossFight()" id="boss-btn">üëπ –ë–û–°–°!</button>
        </div>
        <div class="game-area" id="game-area"></div>
        <div class="tabs">
            <button class="tab-btn active" onclick="game.showTab('shop')">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
            <button class="tab-btn" onclick="game.showTab('quests')">üìú –ö–≤–µ—Å—Ç—ã</button>
            <button class="tab-btn" onclick="game.showTab('skills')">‚ö° –°–∫–∏–ª–ª—ã</button>
            <button class="tab-btn" onclick="game.showTab('pets')">üêæ –ü–∏—Ç–æ–º—Ü—ã</button>
            <button class="tab-btn" onclick="game.showTab('chests')">üì¶ –°—É–Ω–¥—É–∫–∏</button>
            <button class="tab-btn" onclick="game.showTab('skins')">üé® –°–∫–∏–Ω—ã</button>
            <button class="tab-btn" onclick="game.showTab('minigame')">üéÆ –ú–∏–Ω–∏-–∏–≥—Ä–∞</button>
        </div>
        <div class="panel shop tab-content active" id="tab-shop">
            <h2>üõí –ú–∞–≥–∞–∑–∏–Ω</h2>
            <div class="shop-items">
                <div class="shop-item" onclick="game.buySlot()"><div>üì¶ –°–ª–æ—Ç</div><div style="color: #ffd700;">üí∞ <span id="slot-cost">100</span></div></div>
                <div class="shop-item" onclick="game.boostIncome()"><div>‚ö° –î–æ—Ö–æ–¥ x2</div><div style="color: #ffd700;">üí∞ <span id="boost-cost">500</span></div></div>
                <div class="shop-item" onclick="game.buyClickBoost()"><div>üëÜ –ö–ª–∏–∫ x2</div><div style="color: #ffd700;">üí∞ <span id="click-cost">2000</span></div></div>
                <div class="shop-item" onclick="game.buyHighLevel()"><div>üöÄ –£—Ä. <span id="shop-level">5</span></div><div style="color: #ffd700;">üí∞ <span id="high-level-cost">10000</span></div></div>
                <div class="shop-item" onclick="game.buyAutoClicker()"><div>üñ±Ô∏è –ê–≤—Ç–æ–∫–ª–∏–∫</div><div style="color: #ffd700;">üí∞ <span id="autoclick-cost">50000</span></div></div>
                <div class="shop-item" onclick="game.buyDiamonds()"><div>üíé +10 –ê–ª–º–∞–∑–æ–≤</div><div style="color: #ffd700;">üí∞ <span id="diamond-buy-cost">100000</span></div></div>
            </div>
        </div>
        <div class="panel quests-panel tab-content" id="tab-quests">
            <h2>üìú –ö–≤–µ—Å—Ç—ã</h2>
            <div class="quests-list" id="quests-list"></div>
        </div>
        <div class="panel skills-panel tab-content" id="tab-skills">
            <h2>‚ö° –î–µ—Ä–µ–≤–æ —É–º–µ–Ω–∏–π</h2>
            <div class="skills-grid" id="skills-grid"></div>
        </div>
        <div class="panel pets-panel tab-content" id="tab-pets">
            <h2>üêæ –ü–∏—Ç–æ–º—Ü—ã</h2>
            <p>–ê–∫—Ç–∏–≤–Ω—ã–π –ø–∏—Ç–æ–º–µ—Ü: <span id="active-pet">–ù–µ—Ç</span></p>
            <div class="pets-grid" id="pets-grid"></div>
        </div>
        <div class="panel chests-panel tab-content" id="tab-chests">
            <h2>üì¶ –°—É–Ω–¥—É–∫–∏</h2>
            <div class="chests-grid">
                <div class="chest-item" onclick="game.openChest('common')"><div style="font-size: 3em;">üéÅ</div><div>–û–±—ã—á–Ω—ã–π</div><div style="color: #ffd700;">üí∞ 1000</div></div>
                <div class="chest-item" onclick="game.openChest('rare')"><div style="font-size: 3em;">üéÄ</div><div>–†–µ–¥–∫–∏–π</div><div style="color: #ffd700;">üí∞ 5000</div></div>
                <div class="chest-item" onclick="game.openChest('epic')"><div style="font-size: 3em;">üéä</div><div>–≠–ø–∏—á–µ—Å–∫–∏–π</div><div style="color: #00ffff;">üíé 10</div></div>
                <div class="chest-item" onclick="game.openChest('legendary')"><div style="font-size: 3em;">üëë</div><div>–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π</div><div style="color: #00ffff;">üíé 50</div></div>
            </div>
        </div>
        <div class="panel skins-panel tab-content" id="tab-skins">
            <h2>üé® –°–∫–∏–Ω—ã –ø—Ä–µ–¥–º–µ—Ç–æ–≤</h2>
            <div class="skins-grid" id="skins-grid"></div>
        </div>
        <div class="panel minigame-panel tab-content" id="tab-minigame">
            <h2>üéÆ –ü–∞–º—è—Ç—å</h2>
            <p>–ù–∞–π–¥–∏ –ø–∞—Ä—ã! –ù–∞–≥—Ä–∞–¥–∞: üí∞ 5000</p>
            <div class="memory-grid" id="memory-grid"></div>
            <button class="btn" onclick="game.startMemoryGame()">üéÆ –ò–≥—Ä–∞—Ç—å</button>
        </div>
        <div class="panel prestige-panel" id="prestige-panel" style="display: none;">
            <h2>üåü –ü—Ä–µ—Å—Ç–∏–∂</h2>
            <p>–°–±—Ä–æ—Å—å –≤—Å—ë —Ä–∞–¥–∏ <strong>x2 –º–Ω–æ–∂–∏—Ç–µ–ª—è</strong>!</p>
            <button class="btn" onclick="game.doPrestige()" style="background: linear-gradient(45deg, #ff00ff, #8a2be2);">üíé –ü—Ä–µ—Å—Ç–∏–∂</button>
        </div>
        <div class="panel daily-panel">
            <h2>üìÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã</h2>
            <div class="daily-rewards" id="daily-rewards"></div>
            <button class="btn" onclick="game.claimDaily()" id="claim-daily-btn">üéÅ –ü–æ–ª—É—á–∏—Ç—å</button>
        </div>
        <div class="panel wheel-panel">
            <h2>üé∞ –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã</h2>
            <div style="position: relative; width: 200px; height: 200px; margin: 20px auto;">
                <div style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid #fff; z-index: 10;"></div>
                <div id="wheel" style="width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(#ff6b6b 0deg 45deg, #4ecdc4 45deg 90deg, #ffd700 90deg 135deg, #ff00ff 135deg 180deg, #00ff88 180deg 225deg, #ff9500 225deg 270deg, #00bfff 270deg 315deg, #ff1493 315deg 360deg); transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1); box-shadow: 0 0 30px rgba(0,0,0,0.5);"></div>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; background: #fff; border-radius: 50%;"></div>
            </div>
            <button class="btn" onclick="game.spinWheel()" id="spin-btn">üé∞ –ö—Ä—É—Ç–∏—Ç—å (1000üí∞)</button>
        </div>
        <div class="panel boss-panel" id="boss-panel" style="display: none;">
            <h2>üëπ –ë–û–°–°: <span id="boss-name">–°–ª–∏—è–Ω–∏–µ-–î–µ–º–æ–Ω</span></h2>
            <div class="boss-health-bar"><div class="boss-health-fill" id="boss-health" style="width: 100%"></div></div>
            <div class="boss-timer">‚è±Ô∏è <span id="boss-timer">60</span>—Å</div>
            <p>–ù–∞–Ω–æ—Å–∏ —É—Ä–æ–Ω —Å–ª–∏—è–Ω–∏—è–º–∏! –ù–∞–≥—Ä–∞–¥–∞: üíé 100</p>
        </div>
        <div class="panel stats-panel">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                <div style="text-align: center; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 10px;"><div style="font-size: 1.5em; font-weight: bold; color: #ffd700;" id="stat-merges">0</div><div style="font-size: 0.85em; opacity: 0.7;">–°–ª–∏—è–Ω–∏–π</div></div>
                <div style="text-align: center; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 10px;"><div style="font-size: 1.5em; font-weight: bold; color: #ffd700;" id="stat-time">0:00</div><div style="font-size: 0.85em; opacity: 0.7;">–í—Ä–µ–º—è</div></div>
                <div style="text-align: center; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 10px;"><div style="font-size: 1.5em; font-weight: bold; color: #ffd700;" id="stat-earned">0</div><div style="font-size: 0.85em; opacity: 0.7;">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div></div>
                <div style="text-align: center; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 10px;"><div style="font-size: 1.5em; font-weight: bold; color: #ffd700;" id="stat-max-combo">0</div><div style="font-size: 0.85em; opacity: 0.7;">–ú–∞–∫—Å. –∫–æ–º–±–æ</div></div>
            </div>
        </div>
        <div class="panel achievements-panel">
            <h2>üèÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
            <div id="achievements-list"></div>
        </div>
        <div class="autoclicker-panel" id="autoclicker-panel" style="display: none;">
            <div class="autoclicker-status" style="display: flex; align-items: center; gap: 10px;">
                <span>üñ±Ô∏è –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä</span>
                <div class="autoclicker-toggle" id="autoclicker-toggle" onclick="game.toggleAutoClicker()"></div>
            </div>
        </div>
    </div>
    <div class="victory-screen" id="victory">
        <div class="victory-title">üéâ –ü–û–ë–ï–î–ê!</div>
        <p style="font-size: 1.5em; margin-bottom: 30px;">100 —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!</p>
        <p style="font-size: 1.2em; margin-bottom: 20px;">–°—á—ë—Ç: <span id="final-score"></span></p>
        <button class="btn" onclick="game.continueGame()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        <button class="btn" onclick="location.reload()" style="margin-top: 10px;">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    </div>
    <div class="defeat-screen" id="defeat">
        <div style="font-size: 4em; color: #ff0000;">üíÄ –ü–û–†–ê–ñ–ï–ù–ò–ï</div>
        <p style="font-size: 1.5em; margin: 20px;">–ë–æ—Å—Å –ø–æ–±–µ–¥–∏–ª!</p>
        <button class="btn" onclick="game.closeDefeat()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>
    <div class="modal-overlay" id="export-modal">
        <div class="modal">
            <h2>üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</h2>
            <textarea id="save-code" placeholder="–ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è..." style="width: 100%; min-height: 100px;"></textarea>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button class="btn" onclick="game.exportSave()">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
                <button class="btn btn-secondary" onclick="game.importSave()">üì• –ò–º–ø–æ—Ä—Ç</button>
                <button class="btn btn-warning" onclick="game.closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

<script>
class Game {
    constructor() {
        this.coins = 10;
        this.diamonds = 0;
        this.exp = 0;
        this.maxLevel = 1;
        this.items = [];
        this.selectedItems = [];
        this.slots = 12;
        this.playerLevel = 1;
        this.playerXP = 0;
        this.playerXPRequired = 100;
        this.incomeMultiplier = 1;
        this.clickMultiplier = 1;
        this.prestigeMultiplier = 1;
        this.autoMergeUnlocked = false;
        this.turboActive = false;
        this.goldenMode = false;
        this.autoclickerUnlocked = false;
        this.autoclickerActive = false;
        this.costs = { slot: 100, boost: 500, autoMerge: 1000, highLevel: 10000, clickBoost: 2000, turbo: 5000, golden: 10000, autoclicker: 50000, diamonds: 100000 };
        this.shopLevel = 5;
        this.turboCost = 5000;
        this.goldenCost = 10000;
        this.prestigePoints = 0;
        this.combo = 0;
        this.maxCombo = 0;
        this.totalMerges = 0;
        this.totalEarned = 0;
        this.playTime = 0;
        this.lastSaveTime = Date.now();
        this.lastDailyClaim = 0;
        this.dailyStreak = 0;
        this.bossActive = false;
        this.bossHealth = 0;
        this.bossMaxHealth = 0;
        this.bossTimer = 0;
        this.quests = [
            { id: 'merge_10', name: '–°–ª–∏—è–Ω–∏–µ –º–∞—Å—Ç–µ—Ä', desc: '–°–æ–≤–µ—Ä—à–∏ 10 —Å–ª–∏—è–Ω–∏–π', target: 10, current: 0, reward: 500, type: 'merges', completed: false },
            { id: 'reach_20', name: '–î–≤–∞–¥—Ü–∞—Ç–∫–∞', desc: '–î–æ—Å—Ç–∏–≥–Ω–∏ 20 —É—Ä–æ–≤–Ω—è', target: 20, current: 1, reward: 2000, type: 'level', completed: false },
            { id: 'earn_100k', name: '–ë–æ–≥–∞—á', desc: '–ó–∞—Ä–∞–±–æ—Ç–∞–π 100K –º–æ–Ω–µ—Ç', target: 100000, current: 0, reward: 10000, type: 'earned', completed: false },
            { id: 'combo_5', name: '–ö–æ–º–±–æ-–º–∞—Å—Ç–µ—Ä', desc: '–î–æ—Å—Ç–∏–≥–Ω–∏ –∫–æ–º–±–æ x5', target: 5, current: 0, reward: 1000, type: 'combo', completed: false },
            { id: 'buy_slot', name: '–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ', desc: '–ö—É–ø–∏ 5 —Å–ª–æ—Ç–æ–≤', target: 5, current: 0, reward: 2000, type: 'slots', completed: false }
        ];
        this.skills = [
            { id: 'income', name: '–ó–æ–ª–æ—Ç–∞—è –ª–∏—Ö–æ—Ä–∞–¥–∫–∞', icon: 'üí∞', desc: '+50% –∫ –¥–æ—Ö–æ–¥—É', level: 0, maxLevel: 10, cost: 5 },
            { id: 'merge', name: '–ú–∞—Å—Ç–µ—Ä —Å–ª–∏—è–Ω–∏–π', icon: 'üî•', desc: '+25% –∫ –Ω–∞–≥—Ä–∞–¥–∞–º', level: 0, maxLevel: 10, cost: 5 },
            { id: 'speed', name: '–°–∫–æ—Ä–æ—Å—Ç—å', icon: '‚ö°', desc: '–ê–≤—Ç–æ-—Å–ª–∏—è–Ω–∏–µ –±—ã—Å—Ç—Ä–µ–µ', level: 0, maxLevel: 5, cost: 10 },
            { id: 'luck', name: '–£–¥–∞—á–∞', icon: 'üçÄ', desc: '–®–∞–Ω—Å –¥–≤–æ–π–Ω–æ–π –Ω–∞–≥—Ä–∞–¥—ã', level: 0, maxLevel: 5, cost: 15 },
            { id: 'diamond', name: '–ê–ª–º–∞–∑–Ω—ã–π –¥–æ–±—ã—Ç—á–∏–∫', icon: 'üíé', desc: '–ë–æ–ª—å—à–µ –∞–ª–º–∞–∑–æ–≤', level: 0, maxLevel: 5, cost: 20 }
        ];
        this.pets = [
            { id: 'cat', name: '–ö–æ—Ç–∏–∫', icon: 'üê±', bonus: '+10% –¥–æ—Ö–æ–¥', multiplier: 1.1, cost: 50, owned: false, active: false },
            { id: 'dog', name: '–ü—ë—Å–∏–∫', icon: 'üê∂', bonus: '+20% –∫–ª–∏–∫', multiplier: 1.2, cost: 100, owned: false, active: false },
            { id: 'dragon', name: '–î—Ä–∞–∫–æ–Ω', icon: 'üê≤', bonus: '+50% –≤—Å–µ–≥–æ', multiplier: 1.5, cost: 500, owned: false, active: false },
            { id: 'unicorn', name: '–ï–¥–∏–Ω–æ—Ä–æ–≥', icon: 'ü¶Ñ', bonus: 'x2 –∞–ª–º–∞–∑—ã', multiplier: 2, cost: 1000, owned: false, active: false }
        ];
        this.activePet = null;
        this.skins = [
            { id: 'default', name: '–ö–ª–∞—Å—Å–∏–∫–∞', icon: '‚ú®', colors: ['#2ecc71'], unlocked: true, equipped: true },
            { id: 'fire', name: '–û–≥–Ω–µ–Ω–Ω—ã–π', icon: 'üî•', colors: ['#ff6b6b', '#ff0000'], unlocked: false, cost: 100 },
            { id: 'ice', name: '–õ–µ–¥—è–Ω–æ–π', icon: '‚ùÑÔ∏è', colors: ['#00bfff', '#87ceeb'], unlocked: false, cost: 100 },
            { id: 'gold', name: '–ó–æ–ª–æ—Ç–æ–π', icon: 'üëë', colors: ['#ffd700', '#ffaa00'], unlocked: false, cost: 500 },
            { id: 'rainbow', name: '–†–∞–¥—É–∂–Ω—ã–π', icon: 'üåà', colors: ['rainbow'], unlocked: false, cost: 1000 }
        ];
        this.equippedSkin = 'default';
        this.achievements = [
            { id: 'first_merge', name: '–ü–µ—Ä–≤—ã–π —à–∞–≥', desc: '–ü–µ—Ä–≤–æ–µ —Å–ª–∏—è–Ω–∏–µ', icon: 'ü§ù', unlocked: false },
            { id: 'level_10', name: '–ù–æ–≤–∏—á–æ–∫', desc: '10 —É—Ä–æ–≤–µ–Ω—å', icon: 'üå±', unlocked: false },
            { id: 'level_25', name: '–û–ø—ã—Ç–Ω—ã–π', desc: '25 —É—Ä–æ–≤–µ–Ω—å', icon: 'üåø', unlocked: false },
            { id: 'level_50', name: '–ú–∞—Å—Ç–µ—Ä', desc: '50 —É—Ä–æ–≤–µ–Ω—å', icon: 'üå≤', unlocked: false },
            { id: 'level_75', name: '–≠–∫—Å–ø–µ—Ä—Ç', desc: '75 —É—Ä–æ–≤–µ–Ω—å', icon: 'üíé', unlocked: false },
            { id: 'rich', name: '–ú–∏–ª–ª–∏–æ–Ω–µ—Ä', desc: '1M –º–æ–Ω–µ—Ç', icon: 'üí∞', unlocked: false },
            { id: 'automation', name: '–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è', desc: '–ê–≤—Ç–æ-—Å–ª–∏—è–Ω–∏–µ', icon: 'ü§ñ', unlocked: false },
            { id: 'prestige_master', name: '–í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ', desc: '–ü—Ä–µ—Å—Ç–∏–∂', icon: 'üíé', unlocked: false },
            { id: 'collector', name: '–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä', desc: '22 —Å–ª–æ—Ç–∞', icon: 'üì¶', unlocked: false },
            { id: 'combo_king', name: '–ö–æ–º–±–æ –ö–æ—Ä–æ–ª—å', desc: '–ö–æ–º–±–æ x10', icon: 'üî•', unlocked: false },
            { id: 'lucky', name: '–°—á–∞—Å—Ç–ª–∏–≤—á–∏–∫', desc: '–î–∂–µ–∫–ø–æ—Ç', icon: 'üçÄ', unlocked: false },
            { id: 'marathon', name: '–ú–∞—Ä–∞—Ñ–æ–Ω–µ—Ü', desc: '1 —á–∞—Å –∏–≥—Ä—ã', icon: '‚è±Ô∏è', unlocked: false },
            { id: 'boss_slayer', name: '–£–±–∏–π—Ü–∞ –±–æ—Å—Å–æ–≤', desc: '–ü–æ–±–µ–¥–∏ –±–æ—Å—Å–∞', icon: 'üëπ', unlocked: false },
            { id: 'pet_master', name: '–£–∫—Ä–æ—Ç–∏—Ç–µ–ª—å', desc: '–ö—É–ø–∏ –ø–∏—Ç–æ–º—Ü–∞', icon: 'üêæ', unlocked: false },
            { id: 'skill_master', name: '–ì—É—Ä—É', desc: '–ü—Ä–æ–∫–∞—á–∞–π 5 —Å–∫–∏–ª–ª–æ–≤', icon: '‚ö°', unlocked: false }
        ];
        this.memoryGame = { active: false, cards: [], flipped: [], matched: 0 };
        this.emojis = ['üå±', 'üåø', 'üå≤', 'üíé', 'üîÆ', '‚ö°', 'üî•', '‚≠ê', 'üåü', 'üí´', 'üåô', '‚òÄÔ∏è', 'ü™ê', 'üëë', 'üèÜ', 'üéØ', 'üé™', 'üé®', 'üé≠', 'üé™'];
        this.colors = ['#2ecc71', '#27ae60', '#229954', '#1e8449', '#1abc9c', '#16a085', '#3498db', '#2980b9', '#9b59b6', '#8e44ad', '#e74c3c', '#c0392b', '#f39c12', '#d68910', '#f1c40f', '#d4ac0d', '#e67e22', '#d35400', '#95a5a6', '#7f8c8d', '#34495e', '#2c3e50', '#1abc9c', '#16a085', '#2ecc71'];
        this.soundEnabled = true;
        this.lightTheme = false;
        this.init();
    }

    init() {
        this.loadGame();
        this.checkOfflineIncome();
        this.render();
        this.startIncome();
        this.startDiamondIncome();
        this.startAutoSave();
        this.startPlayTime();
        if (this.items.length === 0) this.spawnInitialItems();
        this.renderAchievements();
        this.renderQuests();
        this.renderSkills();
        this.renderPets();
        this.renderSkins();
        this.updatePrestigeUI();
        this.renderDailyRewards();
        this.checkDailyReward();
        this.updateStats();
        this.updatePlayerLevel();
    }

    spawnInitialItems() {
        for (let i = 0; i < 4; i++) this.items.push({ level: 1 });
        this.render();
    }

    addPlayerXP(amount) {
        this.playerXP += amount;
        while (this.playerXP >= this.playerXPRequired) {
            this.playerXP -= this.playerXPRequired;
            this.playerLevel++;
            this.playerXPRequired = Math.floor(this.playerXPRequired * 1.2);
            this.showToast(`üéâ –£—Ä–æ–≤–µ–Ω—å –∏–≥—Ä–æ–∫–∞ ${this.playerLevel}!`);
            this.diamonds += 5;
        }
        this.updatePlayerLevel();
    }

    updatePlayerLevel() {
        document.getElementById('player-level').textContent = this.playerLevel;
        document.getElementById('player-xp-text').textContent = `${this.playerXP}/${this.playerXPRequired} XP`;
        document.getElementById('player-xp-bar').style.width = `${(this.playerXP / this.playerXPRequired) * 100}%`;
    }

    checkOfflineIncome() {
        const now = Date.now();
        const offline = (now - this.lastSaveTime) / 1000;
        if (offline > 60) {
            const hours = Math.floor(offline / 3600);
            const minutes = Math.floor((offline % 3600) / 60);
            const income = Math.floor(this.getIncome() * Math.min(offline, 7200) * 0.5);
            document.getElementById('offline-time').textContent = hours > 0 ? `${hours}—á ${minutes}–º` : `${minutes}–º`;
            document.getElementById('offline-amount').textContent = this.formatNumber(income);
            this.pendingOffline = income;
            document.getElementById('offline-income').classList.add('active');
        }
    }

    claimOffline() {
        this.coins += this.pendingOffline * 2;
        this.showToast(`üí∞ +${this.formatNumber(this.pendingOffline * 2)} –∑–∞ –æ—Ñ—Ñ–ª–∞–π–Ω!`);
        document.getElementById('offline-income').classList.remove('active');
    }

    skipOffline() {
        this.coins += this.pendingOffline;
        document.getElementById('offline-income').classList.remove('active');
    }

    getItemColor(level) {
        const skin = this.skins.find(s => s.id === this.equippedSkin);
        if (skin.id === 'rainbow') return `linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3)`;
        if (skin.id === 'gold' || skin.id === 'fire' || skin.id === 'ice') return `linear-gradient(45deg, ${skin.colors[0]}, ${skin.colors[1]})`;
        if (level >= 100) return `linear-gradient(45deg, #ffd700, #ff6b6b, #4ecdc4)`;
        if (level >= 90) return `linear-gradient(45deg, #ff006e, #8338ec, #3a86ff)`;
        if (level >= 80) return `linear-gradient(45deg, #f72585, #7209b7, #3a0ca3)`;
        if (level >= 70) return `linear-gradient(45deg, #ff006e, #ffbe0b, #fb5607)`;
        if (level >= 60) return `linear-gradient(45deg, #00f5ff, #00bbf9, #00f5d4)`;
        if (level >= 50) return `linear-gradient(45deg, #9b5de5, #f15bb5, #00bbf9)`;
        return this.colors[(level - 1) % this.colors.length] || '#2ecc71';
    }

    getItemEmoji(level) {
        if (level >= 100) return 'üëë';
        if (level >= 90) return 'üíé';
        if (level >= 80) return 'üîÆ';
        if (level >= 70) return '‚ö°';
        if (level >= 60) return 'üî•';
        if (level >= 50) return 'üåü';
        if (level >= 40) return '‚≠ê';
        if (level >= 30) return 'üåô';
        if (level >= 20) return 'ü™ê';
        return this.emojis[(level - 1) % this.emojis.length] || '‚ú®';
    }

    formatNumber(num) {
        if (num >= 1e100) return num.toExponential(2);
        if (num >= 1e18) return (num / 1e18).toFixed(1) + 'Qi';
        if (num >= 1e15) return (num / 1e15).toFixed(1) + 'Qa';
        if (num >= 1e12) return (num / 1e12).toFixed(1) + 'T';
        if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
        if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
        if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
        return Math.floor(num).toString();
    }

    formatTime(seconds) {
        const hours = Math.floor(seconds / 3600);
        const mins = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        if (hours > 0) return `${hours}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    getIncome() {
        let income = 0;
        this.items.forEach(item => { income += Math.pow(2, item.level - 1); });
        const incomeSkill = this.skills.find(s => s.id === 'income');
        if (incomeSkill) income *= (1 + incomeSkill.level * 0.5);
        if (this.activePet && (this.activePet.id === 'cat' || this.activePet.id === 'dragon')) income *= this.activePet.multiplier;
        return income * this.incomeMultiplier * this.prestigeMultiplier;
    }

    startIncome() {
        setInterval(() => {
            if (this.bossActive) return;
            const income = this.getIncome();
            this.coins += income;
            this.totalEarned += income;
            this.updateUI();
            this.checkAchievements();
            this.updateStats();
            this.updateQuests('earned', income);
        }, 1000);
    }

    startDiamondIncome() {
        setInterval(() => {
            let amount = 1;
            const diamondSkill = this.skills.find(s => s.id === 'diamond');
            if (diamondSkill) amount += diamondSkill.level;
            if (this.activePet && this.activePet.id === 'unicorn') amount *= 2;
            this.diamonds += amount;
            this.updateUI();
        }, 60000);
    }

    startAutoSave() {
        setInterval(() => {
            this.lastSaveTime = Date.now();
            this.saveGame();
            this.showToast('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
        }, 60000);
    }

    startPlayTime() {
        setInterval(() => {
            this.playTime++;
            this.updateStats();
            if (this.playTime >= 3600) this.unlockAchievement('marathon');
        }, 1000);
    }

    addCombo() {
        this.combo++;
        if (this.combo > this.maxCombo) this.maxCombo = this.combo;
        if (this.combo >= 10) this.unlockAchievement('combo_king');
        if (this.combo >= 2) this.showCombo();
        this.updateQuests('combo', this.combo);
        clearTimeout(this.comboTimer);
        this.comboTimer = setTimeout(() => { this.combo = 0; this.hideCombo(); }, 3000);
    }

    showCombo() {
        const display = document.getElementById('combo-display');
        const bonus = Math.min(this.combo * 10, 100);
        document.getElementById('combo-count').textContent = this.combo;
        document.getElementById('combo-bonus').textContent = bonus;
        display.classList.add('active');
    }

    hideCombo() {
        document.getElementById('combo-display').classList.remove('active');
    }

    getComboBonus() {
        return 1 + (Math.min(this.combo * 0.1, 1));
    }

    spawnItem() {
        if (this.items.length >= this.slots) {
            this.showFloatingText('–ù–µ—Ç –º–µ—Å—Ç–∞!', window.innerWidth/2, window.innerHeight/2, '#ff6b6b');
            return;
        }
        if (this.coins < 10) {
            this.showFloatingText('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!', window.innerWidth/2, window.innerHeight/2, '#ff6b6b');
            return;
        }
        this.coins -= 10;
        let level = 1;
        const rand = Math.random();
        if (this.goldenMode) level = Math.min(10, Math.floor(this.maxLevel / 3) + 1);
        else if (rand > 0.95 && this.maxLevel >= 10) level = Math.min(10, Math.floor(this.maxLevel / 2));
        else if (rand > 0.8 && this.maxLevel >= 5) level = Math.min(5, Math.floor(this.maxLevel / 3));
        else if (rand > 0.6 && this.maxLevel >= 3) level = 2;
        this.items.push({ level, golden: this.goldenMode });
        this.render();
        this.createParticles(window.innerWidth/2, window.innerHeight/2);
    }

    selectItem(index) {
        const item = this.items[index];
        if (this.autoclickerActive && this.autoclickerUnlocked) {
            const pair = this.items.findIndex((i, idx) => idx !== index && i.level === item.level);
            if (pair !== -1) {
                this.selectedItems = [index, pair];
                this.doSuperMerge();
                return;
            }
        }
        if (this.selectedItems.length > 0) {
            const lastItem = this.items[this.selectedItems[this.selectedItems.length - 1]];
            if (lastItem.level === item.level) {
                this.selectedItems.push(index);
                if (this.selectedItems.length >= 3) {
                    this.doSuperMerge();
                    return;
                }
                this.render();
                return;
            } else {
                this.selectedItems = [index];
                this.render();
                return;
            }
        }
        this.selectedItems = [index];
        this.render();
    }

    doSuperMerge() {
        const level = this.items[this.selectedItems[0]].level;
        const count = this.selectedItems.length;
        const newLevel = level + count - 1;
        const rect = document.querySelector(`[data-index="${this.selectedItems[0]}"]`).getBoundingClientRect();
        const comboBonus = this.getComboBonus();
        let expGain = newLevel * 10 * count * comboBonus;
        let coinBonus = Math.pow(2, newLevel) * count * comboBonus;
        const mergeSkill = this.skills.find(s => s.id === 'merge');
        if (mergeSkill) {
            expGain *= (1 + mergeSkill.level * 0.25);
            coinBonus *= (1 + mergeSkill.level * 0.25);
        }
        if (this.activePet && this.activePet.id === 'dog') coinBonus *= this.activePet.multiplier;
        if (this.activePet && this.activePet.id === 'dragon') {
            expGain *= this.activePet.multiplier;
            coinBonus *= this.activePet.multiplier;
        }
        const luckSkill = this.skills.find(s => s.id === 'luck');
        if (luckSkill && Math.random() < luckSkill.level * 0.05) {
            coinBonus *= 2;
            this.showFloatingText('üíé –£–î–ê–ß–ê! x2', rect.left + 50, rect.top - 30, '#00ffff');
        }
        this.exp += expGain;
        this.coins += coinBonus;
        this.totalMerges += count - 1;
        this.addPlayerXP(Math.floor(expGain / 10));
        if (newLevel > this.maxLevel) {
            this.maxLevel = newLevel;
            this.showFloatingText(`–ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥: ${newLevel}!`, rect.left + 50, rect.top, '#ffd700');
            this.checkAchievements();
        }
        this.showFloatingText(`+${this.formatNumber(coinBonus)}üí∞`, rect.left + 50, rect.top + 30, '#ffd700');
        this.showFloatingText(`+${Math.floor(expGain)}‚≠ê`, rect.left + 50, rect.top + 60, '#4ecdc4');
        if (this.bossActive) {
            const damage = newLevel * 10;
            this.bossHealth -= damage;
            this.showFloatingText(`-${damage}‚ù§Ô∏è`, rect.left + 50, rect.top - 60, '#ff0000');
            this.updateBoss();
        }
        const indicesToRemove = [...this.selectedItems].sort((a, b) => b - a);
        indicesToRemove.forEach(idx => this.items.splice(idx, 1));
        this.items.push({ level: newLevel });
        this.addCombo();
        this.createParticles(rect.left + 50, rect.top + 50);
        this.selectedItems = [];
        this.updateQuests('merges', 1);
        if (newLevel >= 100) this.victory();
        this.render();
    }

    buySlot() {
        if (this.coins >= this.costs.slot) {
            this.coins -= this.costs.slot;
            this.slots++;
            this.costs.slot = Math.floor(this.costs.slot * 1.5);
            this.render();
            this.showFloatingText('+1 —Å–ª–æ—Ç!', window.innerWidth/2, window.innerHeight/2, '#4ecdc4');
            this.updateQuests('slots', 1);
            this.checkAchievements();
        }
    }

    boostIncome() {
        if (this.coins >= this.costs.boost) {
            this.coins -= this.costs.boost;
            this.incomeMultiplier *= 2;
            this.costs.boost = Math.floor(this.costs.boost * 3);
            this.render();
            this.showFloatingText('–î–æ—Ö–æ–¥ x2!', window.innerWidth/2, window.innerHeight/2, '#ffd700');
        }
    }

    buyClickBoost() {
        if (this.coins >= this.costs.clickBoost) {
            this.coins -= this.costs.clickBoost;
            this.clickMultiplier *= 2;
            this.costs.clickBoost = Math.floor(this.costs.clickBoost * 4);
            this.render();
            this.showFloatingText('–ö–ª–∏–∫ x2!', window.innerWidth/2, window.innerHeight/2, '#ff6b6b');
        }
    }

    buyAutoMerge() {
        if (this.autoMergeUnlocked) return;
        if (this.coins >= this.costs.autoMerge) {
            this.coins -= this.costs.autoMerge;
            this.autoMergeUnlocked = true;
            this.startAutoMerge();
            this.showToast('ü§ñ –ê–≤—Ç–æ-—Å–ª–∏—è–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ!');
            this.unlockAchievement('automation');
        }
    }

    buyAutoClicker() {
        if (this.autoclickerUnlocked) return;
        if (this.coins >= this.costs.autoclicker) {
            this.coins -= this.costs.autoclicker;
            this.autoclickerUnlocked = true;
            document.getElementById('autoclicker-panel').style.display = 'block';
            this.render();
            this.showToast('üñ±Ô∏è –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –∫—É–ø–ª–µ–Ω!');
        }
    }

    toggleAutoClicker() {
        this.autoclickerActive = !this.autoclickerActive;
        document.getElementById('autoclicker-toggle').classList.toggle('active', this.autoclickerActive);
        this.showToast(this.autoclickerActive ? 'üñ±Ô∏è –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –í–ö–õ' : 'üñ±Ô∏è –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –í–´–ö–õ');
    }

    buyDiamonds() {
        if (this.coins >= this.costs.diamonds) {
            this.coins -= this.costs.diamonds;
            this.diamonds += 10;
            this.render();
            this.showToast('üíé +10 –∞–ª–º–∞–∑–æ–≤!');
        }
    }

    buyHighLevel() {
        if (this.coins >= this.costs.highLevel) {
            this.coins -= this.costs.highLevel;
            this.items.push({ level: this.shopLevel });
            this.shopLevel += 5;
            this.costs.highLevel = Math.floor(this.costs.highLevel * 5);
            this.render();
            this.showFloatingText(`–ö—É–ø–ª–µ–Ω ${this.shopLevel - 5} —É—Ä.!`, window.innerWidth/2, window.innerHeight/2, '#9b5de5');
        }
    }

    startAutoMerge() {
        const speedSkill = this.skills.find(s => s.id === 'speed');
        const interval = 2000 / (1 + (speedSkill ? speedSkill.level * 0.2 : 0));
        this.autoMergeInterval = setInterval(() => {
            if (this.bossActive) return;
            const levels = {};
            this.items.forEach((item, idx) => {
                if (!levels[item.level]) levels[item.level] = [];
                levels[item.level].push(idx);
            });
            for (let level in levels) {
                if (levels[level].length >= 2) {
                    this.selectedItems = levels[level].slice(0, 2);
                    this.doSuperMerge();
                    break;
                }
            }
        }, interval);
    }

    activateTurbo() {
        if (this.turboActive || this.coins < this.turboCost) {
            if (this.coins < this.turboCost) this.showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
            return;
        }
        this.coins -= this.turboCost;
        this.turboActive = true;
        this.turboCost = Math.floor(this.turboCost * 2);
        document.body.classList.add('turbo-active');
        document.getElementById('turbo-btn').disabled = true;
        if (this.autoMergeInterval) {
            clearInterval(this.autoMergeInterval);
            this.autoMergeInterval = setInterval(() => {
                if (this.bossActive) return;
                const levels = {};
                this.items.forEach((item, idx) => {
                    if (!levels[item.level]) levels[item.level] = [];
                    levels[item.level].push(idx);
                });
                for (let level in levels) {
                    if (levels[level].length >= 2) {
                        this.selectedItems = levels[level].slice(0, 2);
                        this.doSuperMerge();
                        break;
                    }
                }
            }, 500);
        }
        this.showToast('‚ö° –¢–£–†–ë–û –†–ï–ñ–ò–ú!');
        setTimeout(() => {
            this.turboActive = false;
            document.body.classList.remove('turbo-active');
            document.getElementById('turbo-btn').disabled = false;
            if (this.autoMergeInterval) {
                clearInterval(this.autoMergeInterval);
                this.startAutoMerge();
            }
            this.showToast('‚ö° –¢—É—Ä–±–æ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è');
            this.render();
        }, 30000);
        this.render();
    }

    activateGoldenMode() {
        if (this.goldenMode || this.coins < this.goldenCost) {
            if (this.coins < this.goldenCost) this.showToast('‚ùå –ù—É–∂–Ω–æ –±–æ–ª—å—à–µ –º–æ–Ω–µ—Ç!');
            return;
        }
        this.coins -= this.goldenCost;
        this.goldenMode = true;
        this.goldenCost = Math.floor(this.goldenCost * 2);
        document.getElementById('golden-cost').textContent = this.formatNumber(this.goldenCost);
        this.showToast('‚ú® –ó–û–õ–û–¢–û–ô –†–ï–ñ–ò–ú! –í—Å–µ –Ω–æ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã +—É—Ä–æ–≤–µ–Ω—å!');
        setTimeout(() => {
            this.goldenMode = false;
            this.showToast('‚ú® –ó–æ–ª–æ—Ç–æ–π —Ä–µ–∂–∏–º –æ–∫–æ–Ω—á–µ–Ω');
        }, 60000);
        this.render();
    }

    startBossFight() {
        if (this.bossActive) return;
        if (this.maxLevel < 25) {
            this.showToast('‚ùå –ù—É–∂–µ–Ω 25 —É—Ä–æ–≤–µ–Ω—å!');
            return;
        }
        this.bossActive = true;
        this.bossHealth = this.maxLevel * 100;
        this.bossMaxHealth = this.bossHealth;
        this.bossTimer = 60;
        document.getElementById('boss-panel').style.display = 'block';
        document.getElementById('boss-btn').disabled = true;
        this.bossInterval = setInterval(() => {
            this.bossTimer--;
            document.getElementById('boss-timer').textContent = this.bossTimer;
            if (this.bossTimer <= 0 || this.bossHealth <= 0) this.endBossFight();
        }, 1000);
        this.showToast('üëπ –ë–û–°–° –ü–û–Ø–í–ò–õ–°–Ø! –°–ª–∏–≤–∞–π –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è —É—Ä–æ–Ω–∞!');
    }

    updateBoss() {
        const percent = (this.bossHealth / this.bossMaxHealth) * 100;
        document.getElementById('boss-health').style.width = `${Math.max(0, percent)}%`;
        if (this.bossHealth <= 0) this.endBossFight(true);
    }

    endBossFight(victory = false) {
        clearInterval(this.bossInterval);
        this.bossActive = false;
        if (victory) {
            this.diamonds += 100;
            this.showToast('üéâ –ë–û–°–° –ü–û–ë–ï–ñ–î–Å–ù! +100 üíé');
            this.unlockAchievement('boss_slayer');
            this.createParticles(window.innerWidth/2, window.innerHeight/2);
        } else {
            document.getElementById('defeat').classList.add('active');
        }
        document.getElementById('boss-panel').style.display = 'none';
        document.getElementById('boss-btn').disabled = false;
    }

    closeDefeat() {
        document.getElementById('defeat').classList.remove('active');
    }

    doPrestige() {
        if (this.maxLevel < 50) {
            this.showToast('‚ùå –ù—É–∂–µ–Ω 50+ —É—Ä–æ–≤–µ–Ω—å!');
            return;
        }
        if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å –í–°–Å —Ä–∞–¥–∏ x2 –º–Ω–æ–∂–∏—Ç–µ–ª—è?')) return;
        this.prestigePoints++;
        this.prestigeMultiplier *= 2;
        this.coins = 10;
        this.exp = 0;
        this.maxLevel = 1;
        this.items = [];
        this.slots = 12;
        this.incomeMultiplier = 1;
        this.clickMultiplier = 1;
        this.autoMergeUnlocked = false;
        this.turboActive = false;
        this.goldenMode = false;
        this.autoclickerUnlocked = false;
        this.autoclickerActive = false;
        if (this.autoMergeInterval) clearInterval(this.autoMergeInterval);
        this.costs = { slot: 100, boost: 500, autoMerge: 1000, highLevel: 10000, clickBoost: 2000, turbo: 5000, golden: 10000, autoclicker: 50000, diamonds: 100000 };
        this.shopLevel = 5;
        this.turboCost = 5000;
        this.goldenCost = 10000;
        this.spawnInitialItems();
        this.showToast('üíé –ü—Ä–µ—Å—Ç–∏–∂! –ú–Ω–æ–∂–∏—Ç–µ–ª—å x' + this.prestigeMultiplier);
        this.unlockAchievement('prestige_master');
        this.updatePrestigeUI();
        this.render();
    }

    updatePrestigeUI() {
        if (this.prestigePoints > 0) {
            document.getElementById('prestige-box').style.display = 'block';
            document.getElementById('prestige-bonus').style.display = 'inline';
            document.getElementById('prestige-multiplier').textContent = this.prestigeMultiplier;
        }
        if (this.maxLevel >= 40) document.getElementById('prestige-panel').style.display = 'block';
    }

    renderQuests() {
        const container = document.getElementById('quests-list');
        container.innerHTML = this.quests.map(q => {
            const percent = Math.min(100, (q.current / q.target) * 100);
            return `<div class="quest ${q.completed ? 'completed' : ''}"><div class="quest-icon">üìú</div><div class="quest-info"><div class="quest-name">${q.name}</div><div>${q.desc}</div><div class="quest-bar"><div class="quest-bar-fill" style="width: ${percent}%"></div></div><div>${q.current}/${q.target}</div></div><div style="color: #ffd700; font-weight: bold;">üí∞ ${this.formatNumber(q.reward)}</div></div>`;
        }).join('');
    }

    updateQuests(type, amount) {
        this.quests.forEach(q => {
            if (q.type === type && !q.completed) {
                if (type === 'combo') q.current = Math.max(q.current, amount);
                else q.current += amount;
                if (q.current >= q.target) {
                    q.completed = true;
                    this.coins += q.reward;
                    this.showToast(`üìú –ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω: ${q.name}! +${this.formatNumber(q.reward)}üí∞`);
                }
            }
        });
        this.renderQuests();
    }

    renderSkills() {
        const container = document.getElementById('skills-grid');
        container.innerHTML = this.skills.map(s => `<div class="skill"><div class="skill-icon">${s.icon}</div><div style="font-weight: bold;">${s.name}</div><div style="font-size: 0.85em; opacity: 0.8;">${s.desc}</div><div style="color: #ff6b6b; font-weight: bold;">–£—Ä. ${s.level}/${s.maxLevel}</div><button class="btn ${s.level >= s.maxLevel ? 'disabled' : ''}" onclick="game.upgradeSkill('${s.id}')" ${s.level >= s.maxLevel ? 'disabled' : ''}>${s.level >= s.maxLevel ? 'MAX' : `üíé ${s.cost}`}</button></div>`).join('');
    }

    upgradeSkill(id) {
        const skill = this.skills.find(s => s.id === id);
        if (!skill || skill.level >= skill.maxLevel) return;
        if (this.diamonds < skill.cost) {
            this.showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤!');
            return;
        }
        this.diamonds -= skill.cost;
        skill.level++;
        skill.cost = Math.floor(skill.cost * 1.5);
        this.showToast(`‚ö° ${skill.name} +1!`);
        this.renderSkills();
        const upgradedSkills = this.skills.filter(s => s.level > 0).length;
        if (upgradedSkills >= 5) this.unlockAchievement('skill_master');
    }

    renderPets() {
        const container = document.getElementById('pets-grid');
        document.getElementById('active-pet').textContent = this.activePet ? `${this.activePet.icon} ${this.activePet.name}` : '–ù–µ—Ç';
        container.innerHTML = this.pets.map(p => `<div class="pet-item ${p.owned ? (p.active ? 'active' : '') : 'locked'}" onclick="game.togglePet('${p.id}')"><div class="pet-icon">${p.icon}</div><div>${p.name}</div><div style="font-size: 0.85em; color: #ff9500;">${p.bonus}</div><div style="color: ${p.owned ? '#00ff00' : '#00ffff'};">${p.owned ? (p.active ? '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω' : '–ù–∞–∂–º–∏') : `üíé ${p.cost}`}</div></div>`).join('');
    }

    togglePet(id) {
        const pet = this.pets.find(p => p.id === id);
        if (!pet) return;
        if (!pet.owned) {
            if (this.diamonds < pet.cost) {
                this.showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤!');
                return;
            }
            this.diamonds -= pet.cost;
            pet.owned = true;
            this.showToast(`üêæ ${pet.name} –∫—É–ø–ª–µ–Ω!`);
            this.unlockAchievement('pet_master');
        }
        this.pets.forEach(p => p.active = false);
        this.activePet = null;
        pet.active = true;
        this.activePet = pet;
        this.renderPets();
    }

    openChest(type) {
        const costs = { common: 1000, rare: 5000, epic: 10, legendary: 50 };
        const isDiamond = type === 'epic' || type === 'legendary';
        if (isDiamond) {
            if (this.diamonds < costs[type]) {
                this.showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤!');
                return;
            }
            this.diamonds -= costs[type];
        } else {
            if (this.coins < costs[type]) {
                this.showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
                return;
            }
            this.coins -= costs[type];
        }
        const rewards = {
            common: [{ type: 'coins', min: 500, max: 2000 }, { type: 'exp', min: 50, max: 200 }, { type: 'item', level: 3 }],
            rare: [{ type: 'coins', min: 3000, max: 10000 }, { type: 'exp', min: 300, max: 1000 }, { type: 'item', level: 5 }, { type: 'diamonds', min: 1, max: 5 }],
            epic: [{ type: 'coins', min: 10000, max: 50000 }, { type: 'item', level: 10 }, { type: 'diamonds', min: 5, max: 15 }, { type: 'slot', value: 1 }],
            legendary: [{ type: 'coins', min: 100000, max: 500000 }, { type: 'item', level: 25 }, { type: 'diamonds', min: 20, max: 50 }, { type: 'skin', id: 'gold' }]
        };
        const possible = rewards[type];
        const reward = possible[Math.floor(Math.random() * possible.length)];
        switch(reward.type) {
            case 'coins':
                const coins = Math.floor(Math.random() * (reward.max - reward.min) + reward.min);
                this.coins += coins;
                this.showToast(`üéÅ +${this.formatNumber(coins)} –º–æ–Ω–µ—Ç!`);
                break;
            case 'exp':
                const exp = Math.floor(Math.random() * (reward.max - reward.min) + reward.min);
                this.exp += exp;
                this.showToast(`üéÅ +${exp} –æ–ø—ã—Ç–∞!`);
                break;
            case 'item':
                this.items.push({ level: reward.level });
                this.showToast(`üéÅ –ü—Ä–µ–¥–º–µ—Ç ${reward.level} —É—Ä–æ–≤–Ω—è!`);
                break;
            case 'diamonds':
                const diamonds = Math.floor(Math.random() * (reward.max - reward.min) + reward.min);
                this.diamonds += diamonds;
                this.showToast(`üíé +${diamonds} –∞–ª–º–∞–∑–æ–≤!`);
                break;
            case 'slot':
                this.slots += reward.value;
                this.showToast(`üì¶ +${reward.value} —Å–ª–æ—Ç!`);
                break;
            case 'skin':
                const skin = this.skins.find(s => s.id === reward.id);
                if (skin) {
                    skin.unlocked = true;
                    this.showToast(`üé® –°–∫–∏–Ω "${skin.name}" —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!`);
                }
                break;
        }
        this.createParticles(window.innerWidth/2, window.innerHeight/2);
        this.render();
        this.renderSkins();
    }

    renderSkins() {
        const container = document.getElementById('skins-grid');
        container.innerHTML = this.skins.map(s => `<div class="skin-item ${s.equipped ? 'equipped' : ''} ${!s.unlocked ? 'locked' : ''}" onclick="game.equipSkin('${s.id}')"><div style="font-size: 2em;">${s.icon}</div><div>${s.name}</div><div style="color: ${s.unlocked ? '#00ff00' : '#ffd700'};">${s.unlocked ? (s.equipped ? '‚úÖ –ù–∞–¥–µ—Ç' : '–ù–∞–¥–µ—Ç—å') : `üí∞ ${s.cost}`}</div></div>`).join('');
    }

    equipSkin(id) {
        const skin = this.skins.find(s => s.id === id);
        if (!skin) return;
        if (!skin.unlocked) {
            if (this.coins < skin.cost) {
                this.showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
                return;
            }
            this.coins -= skin.cost;
            skin.unlocked = true;
            this.showToast(`üé® –°–∫–∏–Ω "${skin.name}" –∫—É–ø–ª–µ–Ω!`);
        }
        this.skins.forEach(s => s.equipped = false);
        skin.equipped = true;
        this.equippedSkin = id;
        this.renderSkins();
        this.render();
    }

    startMemoryGame() {
        if (this.memoryGame.active) return;
        const emojis = ['üçé', 'üçå', 'üçá', 'üçä', 'üçì', 'üçâ', 'ü•ù', 'üçí'];
        const cards = [...emojis, ...emojis].sort(() => Math.random() - 0.5);
        this.memoryGame = { active: true, cards: cards, flipped: [], matched: 0 };
        this.renderMemoryGame();
    }

    renderMemoryGame() {
        const container = document.getElementById('memory-grid');
        container.innerHTML = this.memoryGame.cards.map((emoji, i) => {
            const isFlipped = this.memoryGame.flipped.includes(i);
            const isMatched = this.memoryGame.matched > 0 && this.memoryGame.flipped.filter(f => this.memoryGame.cards[f] === emoji).length === 2;
            return `<div class="memory-card ${isFlipped ? 'flipped' : ''} ${isMatched ? 'matched' : ''}" onclick="game.flipCard(${i})" style="${isFlipped || isMatched ? '' : 'font-size: 0;'}">${isFlipped || isMatched ? emoji : '?'}</div>`;
        }).join('');
    }

    flipCard(index) {
        if (!this.memoryGame.active) return;
        if (this.memoryGame.flipped.includes(index)) return;
        if (this.memoryGame.flipped.length >= 2) return;
        this.memoryGame.flipped.push(index);
        this.renderMemoryGame();
        if (this.memoryGame.flipped.length === 2) {
            const [a, b] = this.memoryGame.flipped;
            if (this.memoryGame.cards[a] === this.memoryGame.cards[b]) {
                this.memoryGame.matched++;
                this.memoryGame.flipped = [];
                if (this.memoryGame.matched === 8) {
                    this.coins += 5000;
                    this.showToast('üéâ –ü–æ–±–µ–¥–∞! +5000 –º–æ–Ω–µ—Ç!');
                    this.memoryGame.active = false;
                    setTimeout(() => { document.getElementById('memory-grid').innerHTML = ''; }, 2000);
                }
            } else {
                setTimeout(() => { this.memoryGame.flipped = []; this.renderMemoryGame(); }, 1000);
            }
        }
    }

    renderDailyRewards() {
        const container = document.getElementById('daily-rewards');
        const rewards = ['üí∞', 'üíé', '‚ö°', 'üî•', '‚≠ê', 'üéÅ', 'üëë'];
        container.innerHTML = rewards.map((reward, i) => {
            let className = 'daily-item';
            if (i < this.dailyStreak % 7) className += ' claimed';
            else if (i === this.dailyStreak % 7) className += ' today';
            return `<div class="${className}"><div>${reward}</div><small>–î${i+1}</small></div>`;
        }).join('');
    }

    checkDailyReward() {
        const now = Date.now();
        const canClaim = now - this.lastDailyClaim >= 24 * 60 * 60 * 1000;
        document.getElementById('claim-daily-btn').disabled = !canClaim;
        document.getElementById('claim-daily-btn').textContent = canClaim ? 'üéÅ –ü–æ–ª—É—á–∏—Ç—å' : '‚è≥ –ó–∞–≤—Ç—Ä–∞';
    }

    claimDaily() {
        const now = Date.now();
        if (now - this.lastDailyClaim < 24 * 60 * 60 * 1000) return;
        if (now - this.lastDailyClaim < 48 * 60 * 60 * 1000) this.dailyStreak++;
        else this.dailyStreak = 1;
        this.lastDailyClaim = now;
        const day = (this.dailyStreak - 1) % 7;
        const rewards = [{ coins: 100 }, { coins: 250 }, { coins: 500, exp: 100 }, { coins: 1000, item: 3 }, { coins: 2000, exp: 500 }, { coins: 5000, item: 5 }, { coins: 10000, exp: 1000, item: 10, diamonds: 10 }];
        const reward = rewards[day];
        if (reward.coins) {
            this.coins += reward.coins;
            this.showFloatingText(`+${reward.coins}üí∞`, window.innerWidth/2, window.innerHeight/2, '#ffd700');
        }
        if (reward.exp) {
            this.exp += reward.exp;
            this.showFloatingText(`+${reward.exp}‚≠ê`, window.innerWidth/2, window.innerHeight/2 - 30, '#4ecdc4');
        }
        if (reward.item) {
            this.items.push({ level: reward.item });
            this.showFloatingText(`+${reward.item} —É—Ä!`, window.innerWidth/2, window.innerHeight/2 - 60, '#ff6b6b');
        }
        if (reward.diamonds) {
            this.diamonds += reward.diamonds;
            this.showFloatingText(`+${reward.diamonds}üíé`, window.innerWidth/2, window.innerHeight/2 - 90, '#00ffff');
        }
        this.showToast(`üéÅ –î–µ–Ω—å ${this.dailyStreak}!`);
        this.renderDailyRewards();
        this.checkDailyReward();
        this.render();
    }

    spinWheel() {
        if (this.coins < 1000) {
            this.showToast('‚ùå –ù—É–∂–Ω–æ 1000 –º–æ–Ω–µ—Ç!');
            return;
        }
        this.coins -= 1000;
        document.getElementById('spin-btn').disabled = true;
        const wheel = document.getElementById('wheel');
        const degrees = (5 + Math.random() * 5) * 360 + Math.random() * 360;
        wheel.style.transform = `rotate(${degrees}deg)`;
        setTimeout(() => {
            const result = Math.floor((degrees % 360) / 45);
            this.processWheelResult(result);
            document.getElementById('spin-btn').disabled = false;
        }, 4000);
    }

    processWheelResult(segment) {
        const prizes = [
            { type: 'coins', value: 5000, text: '5000üí∞' },
            { type: 'exp', value: 1000, text: '1000‚≠ê' },
            { type: 'item', value: 10, text: '–ü—Ä–µ–¥–º–µ—Ç 10!' },
            { type: 'coins', value: 10000, text: '10000üí∞' },
            { type: 'slot', value: 1, text: '+1 —Å–ª–æ—Ç!' },
            { type: 'coins', value: 2000, text: '2000üí∞' },
            { type: 'diamonds', value: 5, text: '5üíé' },
            { type: 'jackpot', value: 50000, text: '–î–ñ–ï–ö–ü–û–¢ 50000!' }
        ];
        const prize = prizes[segment];
        switch(prize.type) {
            case 'coins': this.coins += prize.value; break;
            case 'exp': this.exp += prize.value; break;
            case 'item': this.items.push({ level: prize.value }); break;
            case 'slot': this.slots++; break;
            case 'diamonds': this.diamonds += prize.value; break;
            case 'jackpot': this.coins += prize.value; this.unlockAchievement('lucky'); break;
        }
        this.showToast(`üé∞ ${prize.text}`);
        this.createParticles(window.innerWidth/2, window.innerHeight/2);
        this.render();
    }

    victory() {
        document.getElementById('final-score').textContent = this.formatNumber(this.coins);
        document.getElementById('victory').classList.add('active');
        this.createFireworks();
    }

    continueGame() {
        document.getElementById('victory').classList.remove('active');
    }

    checkAchievements() {
        const checks = [
            { id: 'level_10', condition: this.maxLevel >= 10 },
            { id: 'level_25', condition: this.maxLevel >= 25 },
            { id: 'level_50', condition: this.maxLevel >= 50 },
            { id: 'level_75', condition: this.maxLevel >= 75 },
            { id: 'rich', condition: this.coins >= 1000000 },
            { id: 'collector', condition: this.slots >= 22 }
        ];
        checks.forEach(check => { if (check.condition) this.unlockAchievement(check.id); });
    }

    unlockAchievement(id) {
        const ach = this.achievements.find(a => a.id === id);
        if (ach && !ach.unlocked) {
            ach.unlocked = true;
            this.renderAchievements();
            this.showToast(`üèÖ ${ach.name}!`);
        }
    }

    renderAchievements() {
        const container = document.getElementById('achievements-list');
        container.innerHTML = this.achievements.map(ach => `<div class="achievement ${ach.unlocked ? 'unlocked' : ''}"><div class="achievement-icon">${ach.icon}</div><div class="achievement-info"><div class="achievement-name">${ach.name}</div><div class="achievement-desc">${ach.desc}</div></div><div>${ach.unlocked ? '‚úÖ' : 'üîí'}</div></div>`).join('');
    }

    updateStats() {
        document.getElementById('stat-merges').textContent = this.formatNumber(this.totalMerges);
        document.getElementById('stat-time').textContent = this.formatTime(this.playTime);
        document.getElementById('stat-earned').textContent = this.formatNumber(this.totalEarned);
        document.getElementById('stat-max-combo').textContent = this.maxCombo;
    }

    showTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
        document.getElementById(`tab-${tabName}`).classList.add('active');
        event.target.classList.add('active');
    }

    toggleTheme() {
        this.lightTheme = !this.lightTheme;
        document.body.classList.toggle('light-theme', this.lightTheme);
        document.querySelectorAll('.settings-btn')[1].textContent = this.lightTheme ? '‚òÄÔ∏è' : 'üåô';
    }

    showExportModal() {
        document.getElementById('export-modal').classList.add('active');
    }

    closeModal() {
        document.getElementById('export-modal').classList.remove('active');
    }

    exportSave() {
        const data = {
            coins: this.coins, diamonds: this.diamonds, exp: this.exp, maxLevel: this.maxLevel,
            items: this.items, slots: this.slots, incomeMultiplier: this.incomeMultiplier,
            clickMultiplier: this.clickMultiplier, autoMergeUnlocked: this.autoMergeUnlocked,
            costs: this.costs, shopLevel: this.shopLevel, prestigePoints: this.prestigePoints,
            prestigeMultiplier: this.prestigeMultiplier, achievements: this.achievements,
            totalMerges: this.totalMerges, totalEarned: this.totalEarned, playTime: this.playTime,
            maxCombo: this.maxCombo, dailyStreak: this.dailyStreak, lastDailyClaim: this.lastDailyClaim,
            skills: this.skills, pets: this.pets, skins: this.skins, equippedSkin: this.equippedSkin,
            playerLevel: this.playerLevel, playerXP: this.playerXP, playerXPRequired: this.playerXPRequired,
            quests: this.quests, autoclickerUnlocked: this.autoclickerUnlocked
        };
        document.getElementById('save-code').value = btoa(JSON.stringify(data));
        this.showToast('üì§ –ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
    }

    importSave() {
        try {
            const code = document.getElementById('save-code').value.trim();
            if (!code) return;
            const data = JSON.parse(atob(code));
            Object.assign(this, data);
            if (this.autoMergeUnlocked) this.startAutoMerge();
            this.closeModal();
            this.showToast('üì• –ó–∞–≥—Ä—É–∂–µ–Ω–æ!');
            this.render();
            this.renderQuests();
            this.renderSkills();
            this.renderPets();
            this.renderSkins();
            this.renderDailyRewards();
            this.checkDailyReward();
            this.updatePlayerLevel();
            if (this.autoclickerUnlocked) document.getElementById('autoclicker-panel').style.display = 'block';
        } catch (e) {
            this.showToast('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!');
        }
    }

    resetGame() {
        if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å –í–°–Å –ø—Ä–æ–≥—Ä–µ—Å—Å?')) return;
        localStorage.removeItem('merge100_save');
        location.reload();
    }

    saveGame() {
        const data = {
            coins: this.coins, diamonds: this.diamonds, exp: this.exp, maxLevel: this.maxLevel,
            items: this.items, slots: this.slots, incomeMultiplier: this.incomeMultiplier,
            clickMultiplier: this.clickMultiplier, autoMergeUnlocked: this.autoMergeUnlocked,
            costs: this.costs, shopLevel: this.shopLevel, prestigePoints: this.prestigePoints,
            prestigeMultiplier: this.prestigeMultiplier, achievements: this.achievements,
            totalMerges: this.totalMerges, totalEarned: this.totalEarned, playTime: this.playTime,
            maxCombo: this.maxCombo, dailyStreak: this.dailyStreak, lastDailyClaim: this.lastDailyClaim,
            lastSaveTime: Date.now(), skills: this.skills, pets: this.pets, skins: this.skins,
            equippedSkin: this.equippedSkin, playerLevel: this.playerLevel, playerXP: this.playerXP,
            playerXPRequired: this.playerXPRequired, quests: this.quests, autoclickerUnlocked: this.autoclickerUnlocked
        };
        localStorage.setItem('merge100_save', JSON.stringify(data));
    }

    loadGame() {
        const saved = localStorage.getItem('merge100_save');
        if (saved) {
            const data = JSON.parse(saved);
            Object.assign(this, data);
            if (this.autoMergeUnlocked) this.startAutoMerge();
            if (this.autoclickerUnlocked) document.getElementById('autoclicker-panel').style.display = 'block';
        }
    }

    toggleSound() {
        this.soundEnabled = !this.soundEnabled;
        document.querySelectorAll('.settings-btn')[0].textContent = this.soundEnabled ? 'üîä' : 'üîá';
    }

    showFloatingText(text, x, y, color) {
        const el = document.createElement('div');
        el.className = 'floating-text';
        el.textContent = text;
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        el.style.color = color;
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 1000);
    }

    showToast(message) {
        const existing = document.querySelector('.toast');
        if (existing) existing.remove();
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }

    createParticles(x, y) {
        for (let i = 0; i < 20; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            particle.style.setProperty('--tx', (Math.random() - 0.5) * 200 + 'px');
            particle.style.setProperty('--ty', (Math.random() - 0.5) * 200 + 'px');
            particle.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), 1000);
        }
    }

    createFireworks() {
        setInterval(() => {
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight;
            this.createParticles(x, y);
        }, 500);
    }

    updateUI() {
        document.getElementById('coins').textContent = this.formatNumber(this.coins);
        document.getElementById('diamonds').textContent = this.diamonds;
        document.getElementById('exp').textContent = this.formatNumber(this.exp);
        document.getElementById('max-level').textContent = this.maxLevel;
        document.getElementById('prestige-points').textContent = this.prestigePoints;
        document.getElementById('income-display').textContent = this.formatNumber(this.getIncome());
        document.getElementById('turbo-cost').textContent = this.formatNumber(this.turboCost);
        document.getElementById('golden-cost').textContent = this.formatNumber(this.goldenCost);
        const diamondIncome = 1 + (this.skills.find(s => s.id === 'diamond')?.level || 0);
        document.getElementById('diamond-income').textContent = this.activePet?.id === 'unicorn' ? diamondIncome * 2 : diamondIncome;
        document.getElementById('slot-cost').textContent = this.formatNumber(this.costs.slot);
        document.getElementById('boost-cost').textContent = this.formatNumber(this.costs.boost);
        document.getElementById('auto-merge-cost').textContent = this.autoMergeUnlocked ? '‚úÖ' : this.formatNumber(this.costs.autoMerge);
        document.getElementById('high-level-cost').textContent = this.formatNumber(this.costs.highLevel);
        document.getElementById('click-cost').textContent = this.formatNumber(this.costs.clickBoost);
        document.getElementById('autoclick-cost').textContent = this.formatNumber(this.costs.autoclicker);
        document.getElementById('diamond-buy-cost').textContent = this.formatNumber(this.costs.diamonds);
        document.getElementById('shop-level').textContent = this.shopLevel;
        this.updatePrestigeUI();
    }

    render() {
        this.updateUI();
        const container = document.getElementById('game-area');
        container.innerHTML = '';
        this.items.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = `item ${item.golden ? 'golden' : ''}`;
            if (this.selectedItems.includes(index)) div.classList.add('selected');
            if (item.level >= 100) div.classList.add('max-level');
            div.style.background = this.getItemColor(item.level);
            div.dataset.index = index;
            div.innerHTML = `<div class="item-icon">${this.getItemEmoji(item.level)}</div><div class="item-level">${item.level}</div>`;
            div.onclick = () => this.selectItem(index);
            container.appendChild(div);
        });
        for (let i = this.items.length; i < this.slots; i++) {
            const div = document.createElement('div');
            div.className = 'item';
            div.style.background = 'rgba(255,255,255,0.05)';
            div.style.border = '2px dashed rgba(255,255,255,0.2)';
            div.style.cursor = 'default';
            div.innerHTML = '<div style="opacity: 0.3; font-size: 2em;">+</div>';
            container.appendChild(div);
        }
    }
}

<script>
class Game {
    constructor() {
        this.coins = 10;
        this.diamonds = 0;
        this.exp = 0;
        this.maxLevel = 1;
        this.items = [];
        this.selectedItems = [];
        this.slots = 12;
        this.playerLevel = 1;
        this.playerXP = 0;
        this.playerXPRequired = 100;
        this.incomeMultiplier = 1;
        this.clickMultiplier = 1;
        this.prestigeMultiplier = 1;
        this.autoMergeUnlocked = false;
        this.turboActive = false;
        this.goldenMode = false;
        this.autoclickerUnlocked = false;
        this.autoclickerActive = false;
        this.costs = { slot: 100, boost: 500, autoMerge: 1000, highLevel: 10000, clickBoost: 2000, turbo: 5000, golden: 10000, autoclicker: 50000, diamonds: 100000 };
        this.shopLevel = 5;
        this.turboCost = 5000;
        this.goldenCost = 10000;
        this.prestigePoints = 0;
        this.combo = 0;
        this.maxCombo = 0;
        this.totalMerges = 0;
        this.totalEarned = 0;
        this.playTime = 0;
        this.lastSaveTime = Date.now();
        this.lastDailyClaim = 0;
        this.dailyStreak = 0;
        this.bossActive = false;
        this.bossHealth = 0;
        this.bossMaxHealth = 0;
        this.bossTimer = 0;
        this.quests = [
            { id: 'merge_10', name: '–°–ª–∏—è–Ω–∏–µ –º–∞—Å—Ç–µ—Ä', desc: '–°–æ–≤–µ—Ä—à–∏ 10 —Å–ª–∏—è–Ω–∏–π', target: 10, current: 0, reward: 500, type: 'merges', completed: false },
            { id: 'reach_20', name: '–î–≤–∞–¥—Ü–∞—Ç–∫–∞', desc: '–î–æ—Å—Ç–∏–≥–Ω–∏ 20 —É—Ä–æ–≤–Ω—è', target: 20, current: 1, reward: 2000, type: 'level', completed: false },
            { id: 'earn_100k', name: '–ë–æ–≥–∞—á', desc: '–ó–∞—Ä–∞–±–æ—Ç–∞–π 100K –º–æ–Ω–µ—Ç', target: 100000, current: 0, reward: 10000, type: 'earned', completed: false },
            { id: 'combo_5', name: '–ö–æ–º–±–æ-–º–∞—Å—Ç–µ—Ä', desc: '–î–æ—Å—Ç–∏–≥–Ω–∏ –∫–æ–º–±–æ x5', target: 5, current: 0, reward: 1000, type: 'combo', completed: false },
            { id: 'buy_slot', name: '–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ', desc: '–ö—É–ø–∏ 5 —Å–ª–æ—Ç–æ–≤', target: 5, current: 0, reward: 2000, type: 'slots', completed: false }
        ];
        this.skills = [
            { id: 'income', name: '–ó–æ–ª–æ—Ç–∞—è –ª–∏—Ö–æ—Ä–∞–¥–∫–∞', icon: 'üí∞', desc: '+50% –∫ –¥–æ—Ö–æ–¥—É', level: 0, maxLevel: 10, cost: 5 },
            { id: 'merge', name: '–ú–∞—Å—Ç–µ—Ä —Å–ª–∏—è–Ω–∏–π', icon: 'üî•', desc: '+25% –∫ –Ω–∞–≥—Ä–∞–¥–∞–º', level: 0, maxLevel: 10, cost: 5 },
            { id: 'speed', name: '–°–∫–æ—Ä–æ—Å—Ç—å', icon: '‚ö°', desc: '–ê–≤—Ç–æ-—Å–ª–∏—è–Ω–∏–µ –±—ã—Å—Ç—Ä–µ–µ', level: 0, maxLevel: 5, cost: 10 },
            { id: 'luck', name: '–£–¥–∞—á–∞', icon: 'üçÄ', desc: '–®–∞–Ω—Å –¥–≤–æ–π–Ω–æ–π –Ω–∞–≥—Ä–∞–¥—ã', level: 0, maxLevel: 5, cost: 15 },
            { id: 'diamond', name: '–ê–ª–º–∞–∑–Ω—ã–π –¥–æ–±—ã—Ç—á–∏–∫', icon: 'üíé', desc: '–ë–æ–ª—å—à–µ –∞–ª–º–∞–∑–æ–≤', level: 0, maxLevel: 5, cost: 20 }
        ];
        this.pets = [
            { id: 'cat', name: '–ö–æ—Ç–∏–∫', icon: 'üê±', bonus: '+10% –¥–æ—Ö–æ–¥', multiplier: 1.1, cost: 50, owned: false, active: false },
            { id: 'dog', name: '–ü—ë—Å–∏–∫', icon: 'üê∂', bonus: '+20% –∫–ª–∏–∫', multiplier: 1.2, cost: 100, owned: false, active: false },
            { id: 'dragon', name: '–î—Ä–∞–∫–æ–Ω', icon: 'üê≤', bonus: '+50% –≤—Å–µ–≥–æ', multiplier: 1.5, cost: 500, owned: false, active: false },
            { id: 'unicorn', name: '–ï–¥–∏–Ω–æ—Ä–æ–≥', icon: 'ü¶Ñ', bonus: 'x2 –∞–ª–º–∞–∑—ã', multiplier: 2, cost: 1000, owned: false, active: false }
        ];
        this.activePet = null;
        this.skins = [
            { id: 'default', name: '–ö–ª–∞—Å—Å–∏–∫–∞', icon: '‚ú®', colors: ['#2ecc71'], unlocked: true, equipped: true },
            { id: 'fire', name: '–û–≥–Ω–µ–Ω–Ω—ã–π', icon: 'üî•', colors: ['#ff6b6b', '#ff0000'], unlocked: false, cost: 100 },
            { id: 'ice', name: '–õ–µ–¥—è–Ω–æ–π', icon: '‚ùÑÔ∏è', colors: ['#00bfff', '#87ceeb'], unlocked: false, cost: 100 },
            { id: 'gold', name: '–ó–æ–ª–æ—Ç–æ–π', icon: 'üëë', colors: ['#ffd700', '#ffaa00'], unlocked: false, cost: 500 },
            { id: 'rainbow', name: '–†–∞–¥—É–∂–Ω—ã–π', icon: 'üåà', colors: ['rainbow'], unlocked: false, cost: 1000 }
        ];
        this.equippedSkin = 'default';
        this.achievements = [
            { id: 'first_merge', name: '–ü–µ—Ä–≤—ã–π —à–∞–≥', desc: '–ü–µ—Ä–≤–æ–µ —Å–ª–∏—è–Ω–∏–µ', icon: 'ü§ù', unlocked: false },
            { id: 'level_10', name: '–ù–æ–≤–∏—á–æ–∫', desc: '10 —É—Ä–æ–≤–µ–Ω—å', icon: 'üå±', unlocked: false },
            { id: 'level_25', name: '–û–ø—ã—Ç–Ω—ã–π', desc: '25 —É—Ä–æ–≤–µ–Ω—å', icon: 'üåø', unlocked: false },
            { id: 'level_50', name: '–ú–∞—Å—Ç–µ—Ä', desc: '50 —É—Ä–æ–≤–µ–Ω—å', icon: 'üå≤', unlocked: false },
            { id: 'level_75', name: '–≠–∫—Å–ø–µ—Ä—Ç', desc: '75 —É—Ä–æ–≤–µ–Ω—å', icon: 'üíé', unlocked: false },
            { id: 'rich', name: '–ú–∏–ª–ª–∏–æ–Ω–µ—Ä', desc: '1M –º–æ–Ω–µ—Ç', icon: 'üí∞', unlocked: false },
            { id: 'automation', name: '–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è', desc: '–ê–≤—Ç–æ-—Å–ª–∏—è–Ω–∏–µ', icon: 'ü§ñ', unlocked: false },
            { id: 'prestige_master', name: '–í–æ–∑—Ä–æ–∂–¥–µ–Ω–∏–µ', desc: '–ü—Ä–µ—Å—Ç–∏–∂', icon: 'üíé', unlocked: false },
            { id: 'collector', name: '–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä', desc: '22 —Å–ª–æ—Ç–∞', icon: 'üì¶', unlocked: false },
            { id: 'combo_king', name: '–ö–æ–º–±–æ –ö–æ—Ä–æ–ª—å', desc: '–ö–æ–º–±–æ x10', icon: 'üî•', unlocked: false },
            { id: 'lucky', name: '–°—á–∞—Å—Ç–ª–∏–≤—á–∏–∫', desc: '–î–∂–µ–∫–ø–æ—Ç', icon: 'üçÄ', unlocked: false },
            { id: 'marathon', name: '–ú–∞—Ä–∞—Ñ–æ–Ω–µ—Ü', desc: '1 —á–∞—Å –∏–≥—Ä—ã', icon: '‚è±Ô∏è', unlocked: false },
            { id: 'boss_slayer', name: '–£–±–∏–π—Ü–∞ –±–æ—Å—Å–æ–≤', desc: '–ü–æ–±–µ–¥–∏ –±–æ—Å—Å–∞', icon: 'üëπ', unlocked: false },
            { id: 'pet_master', name: '–£–∫—Ä–æ—Ç–∏—Ç–µ–ª—å', desc: '–ö—É–ø–∏ –ø–∏—Ç–æ–º—Ü–∞', icon: 'üêæ', unlocked: false },
            { id: 'skill_master', name: '–ì—É—Ä—É', desc: '–ü—Ä–æ–∫–∞—á–∞–π 5 —Å–∫–∏–ª–ª–æ–≤', icon: '‚ö°', unlocked: false }
        ];
        this.memoryGame = { active: false, cards: [], flipped: [], matched: 0 };
        this.emojis = ['üå±', 'üåø', 'üå≤', 'üíé', 'üîÆ', '‚ö°', 'üî•', '‚≠ê', 'üåü', 'üí´', 'üåô', '‚òÄÔ∏è', 'ü™ê', 'üëë', 'üèÜ', 'üéØ', 'üé™', 'üé®', 'üé≠', 'üé™'];
        this.colors = ['#2ecc71', '#27ae60', '#229954', '#1e8449', '#1abc9c', '#16a085', '#3498db', '#2980b9', '#9b59b6', '#8e44ad', '#e74c3c', '#c0392b', '#f39c12', '#d68910', '#f1c40f', '#d4ac0d', '#e67e22', '#d35400', '#95a5a6', '#7f8c8d', '#34495e', '#2c3e50', '#1abc9c', '#16a085', '#2ecc71'];
        this.soundEnabled = true;
        this.lightTheme = false;
        this.init();
    }

    init() {
        this.loadGame();
        this.checkOfflineIncome();
        this.render();
        this.startIncome();
        this.startDiamondIncome();
        this.startAutoSave();
        this.startPlayTime();
        if (this.items.length === 0) this.spawnInitialItems();
        this.renderAchievements();
        this.renderQuests();
        this.renderSkills();
        this.renderPets();
        this.renderSkins();
        this.updatePrestigeUI();
        this.renderDailyRewards();
        this.checkDailyReward();
        this.updateStats();
        this.updatePlayerLevel();
    }

    spawnInitialItems() {
        for (let i = 0; i < 4; i++) this.items.push({ level: 1 });
        this.render();
    }

    addPlayerXP(amount) {
        this.playerXP += amount;
        while (this.playerXP >= this.playerXPRequired) {
            this.playerXP -= this.playerXPRequired;
            this.playerLevel++;
            this.playerXPRequired = Math.floor(this.playerXPRequired * 1.2);
            this.showToast(`üéâ –£—Ä–æ–≤–µ–Ω—å –∏–≥—Ä–æ–∫–∞ ${this.playerLevel}!`);
            this.diamonds += 5;
        }
        this.updatePlayerLevel();
    }

    updatePlayerLevel() {
        document.getElementById('player-level').textContent = this.playerLevel;
        document.getElementById('player-xp-text').textContent = `${this.playerXP}/${this.playerXPRequired} XP`;
        document.getElementById('player-xp-bar').style.width = `${(this.playerXP / this.playerXPRequired) * 100}%`;
    }

    checkOfflineIncome() {
        const now = Date.now();
        const offline = (now - this.lastSaveTime) / 1000;
        if (offline > 60) {
            const hours = Math.floor(offline / 3600);
            const minutes = Math.floor((offline % 3600) / 60);
            const income = Math.floor(this.getIncome() * Math.min(offline, 7200) * 0.5);
            document.getElementById('offline-time').textContent = hours > 0 ? `${hours}—á ${minutes}–º` : `${minutes}–º`;
            document.getElementById('offline-amount').textContent = this.formatNumber(income);
            this.pendingOffline = income;
            document.getElementById('offline-income').classList.add('active');
        }
    }

    claimOffline() {
        this.coins += this.pendingOffline * 2;
        this.showToast(`üí∞ +${this.formatNumber(this.pendingOffline * 2)} –∑–∞ –æ—Ñ—Ñ–ª–∞–π–Ω!`);
        document.getElementById('offline-income').classList.remove('active');
    }

    skipOffline() {
        this.coins += this.pendingOffline;
        document.getElementById('offline-income').classList.remove('active');
    }

    getItemColor(level) {
        const skin = this.skins.find(s => s.id === this.equippedSkin);
        if (skin.id === 'rainbow') return `linear-gradient(45deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3)`;
        if (skin.id === 'gold' || skin.id === 'fire' || skin.id === 'ice') return `linear-gradient(45deg, ${skin.colors[0]}, ${skin.colors[1]})`;
        if (level >= 100) return `linear-gradient(45deg, #ffd700, #ff6b6b, #4ecdc4)`;
        if (level >= 90) return `linear-gradient(45deg, #ff006e, #8338ec, #3a86ff)`;
        if (level >= 80) return `linear-gradient(45deg, #f72585, #7209b7, #3a0ca3)`;
        if (level >= 70) return `linear-gradient(45deg, #ff006e, #ffbe0b, #fb5607)`;
        if (level >= 60) return `linear-gradient(45deg, #00f5ff, #00bbf9, #00f5d4)`;
        if (level >= 50) return `linear-gradient(45deg, #9b5de5, #f15bb5, #00bbf9)`;
        return this.colors[(level - 1) % this.colors.length] || '#2ecc71';
    }

    getItemEmoji(level) {
        if (level >= 100) return 'üëë';
        if (level >= 90) return 'üíé';
        if (level >= 80) return 'üîÆ';
        if (level >= 70) return '‚ö°';
        if (level >= 60) return 'üî•';
        if (level >= 50) return 'üåü';
        if (level >= 40) return '‚≠ê';
        if (level >= 30) return 'üåô';
        if (level >= 20) return 'ü™ê';
        return this.emojis[(level - 1) % this.emojis.length] || '‚ú®';
    }

    formatNumber(num) {
        if (num >= 1e100) return num.toExponential(2);
        if (num >= 1e18) return (num / 1e18).toFixed(1) + 'Qi';
        if (num >= 1e15) return (num / 1e15).toFixed(1) + 'Qa';
        if (num >= 1e12) return (num / 1e12).toFixed(1) + 'T';
        if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
        if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
        if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
        return Math.floor(num).toString();
    }

    formatTime(seconds) {
        const hours = Math.floor(seconds / 3600);
        const mins = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        if (hours > 0) return `${hours}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    getIncome() {
        let income = 0;
        this.items.forEach(item => { income += Math.pow(2, item.level - 1); });
        const incomeSkill = this.skills.find(s => s.id === 'income');
        if (incomeSkill) income *= (1 + incomeSkill.level * 0.5);
        if (this.activePet && (this.activePet.id === 'cat' || this.activePet.id === 'dragon')) income *= this.activePet.multiplier;
        return income * this.incomeMultiplier * this.prestigeMultiplier;
    }

    startIncome() {
        setInterval(() => {
            if (this.bossActive) return;
            const income = this.getIncome();
            this.coins += income;
            this.totalEarned += income;
            this.updateUI();
            this.checkAchievements();
            this.updateStats();
            this.updateQuests('earned', income);
        }, 1000);
    }

    startDiamondIncome() {
        setInterval(() => {
            let amount = 1;
            const diamondSkill = this.skills.find(s => s.id === 'diamond');
            if (diamondSkill) amount += diamondSkill.level;
            if (this.activePet && this.activePet.id === 'unicorn') amount *= 2;
            this.diamonds += amount;
            this.updateUI();
        }, 60000);
    }

    startAutoSave() {
        setInterval(() => {
            this.lastSaveTime = Date.now();
            this.saveGame();
            this.showToast('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
        }, 60000);
    }

    startPlayTime() {
        setInterval(() => {
            this.playTime++;
            this.updateStats();
            if (this.playTime >= 3600) this.unlockAchievement('marathon');
        }, 1000);
    }

    addCombo() {
        this.combo++;
        if (this.combo > this.maxCombo) this.maxCombo = this.combo;
        if (this.combo >= 10) this.unlockAchievement('combo_king');
        if (this.combo >= 2) this.showCombo();
        this.updateQuests('combo', this.combo);
        clearTimeout(this.comboTimer);
        this.comboTimer = setTimeout(() => { this.combo = 0; this.hideCombo(); }, 3000);
    }

    showCombo() {
        const display = document.getElementById('combo-display');
        const bonus = Math.min(this.combo * 10, 100);
        document.getElementById('combo-count').textContent = this.combo;
        document.getElementById('combo-bonus').textContent = bonus;
        display.classList.add('active');
    }

    hideCombo() {
        document.getElementById('combo-display').classList.remove('active');
    }

    getComboBonus() {
        return 1 + (Math.min(this.combo * 0.1, 1));
    }

    spawnItem() {
        if (this.items.length >= this.slots) {
            this.showFloatingText('–ù–µ—Ç –º–µ—Å—Ç–∞!', window.innerWidth/2, window.innerHeight/2, '#ff6b6b');
            return;
        }
        if (this.coins < 10) {
            this.showFloatingText('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!', window.innerWidth/2, window.innerHeight/2, '#ff6b6b');
            return;
        }
        this.coins -= 10;
        let level = 1;
        const rand = Math.random();
        if (this.goldenMode) level = Math.min(10, Math.floor(this.maxLevel / 3) + 1);
        else if (rand > 0.95 && this.maxLevel >= 10) level = Math.min(10, Math.floor(this.maxLevel / 2));
        else if (rand > 0.8 && this.maxLevel >= 5) level = Math.min(5, Math.floor(this.maxLevel / 3));
        else if (rand > 0.6 && this.maxLevel >= 3) level = 2;
        this.items.push({ level, golden: this.goldenMode });
        this.render();
        this.createParticles(window.innerWidth/2, window.innerHeight/2);
    }

    selectItem(index) {
        const item = this.items[index];
        if (this.autoclickerActive && this.autoclickerUnlocked) {
            const pair = this.items.findIndex((i, idx) => idx !== index && i.level === item.level);
            if (pair !== -1) {
                this.selectedItems = [index, pair];
                this.doSuperMerge();
                return;
            }
        }
        if (this.selectedItems.length > 0) {
            const lastItem = this.items[this.selectedItems[this.selectedItems.length - 1]];
            if (lastItem.level === item.level) {
                this.selectedItems.push(index);
                if (this.selectedItems.length >= 3) {
                    this.doSuperMerge();
                    return;
                }
                this.render();
                return;
            } else {
                this.selectedItems = [index];
                this.render();
                return;
            }
        }
        this.selectedItems = [index];
        this.render();
    }

    doSuperMerge() {
        const level = this.items[this.selectedItems[0]].level;
        const count = this.selectedItems.length;
        const newLevel = level + count - 1;
        const rect = document.querySelector(`[data-index="${this.selectedItems[0]}"]`).getBoundingClientRect();
        const comboBonus = this.getComboBonus();
        let expGain = newLevel * 10 * count * comboBonus;
        let coinBonus = Math.pow(2, newLevel) * count * comboBonus;
        const mergeSkill = this.skills.find(s => s.id === 'merge');
        if (mergeSkill) {
            expGain *= (1 + mergeSkill.level * 0.25);
            coinBonus *= (1 + mergeSkill.level * 0.25);
        }
        if (this.activePet && this.activePet.id === 'dog') coinBonus *= this.activePet.multiplier;
        if (this.activePet && this.activePet.id === 'dragon') {
            expGain *= this.activePet.multiplier;
            coinBonus *= this.activePet.multiplier;
        }
        const luckSkill = this.skills.find(s => s.id === 'luck');
        if (luckSkill && Math.random() < luckSkill.level * 0.05) {
            coinBonus *= 2;
            this.showFloatingText('üíé –£–î–ê–ß–ê! x2', rect.left + 50, rect.top - 30, '#00ffff');
        }
        this.exp += expGain;
        this.coins += coinBonus;
        this.totalMerges += count - 1;
        this.addPlayerXP(Math.floor(expGain / 10));
        if (newLevel > this.maxLevel) {
            this.maxLevel = newLevel;
            this.showFloatingText(`–ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥: ${newLevel}!`, rect.left + 50, rect.top, '#ffd700');
            this.checkAchievements();
        }
        this.showFloatingText(`+${this.formatNumber(coinBonus)}üí∞`, rect.left + 50, rect.top + 30, '#ffd700');
        this.showFloatingText(`+${Math.floor(expGain)}‚≠ê`, rect.left + 50, rect.top + 60, '#4ecdc4');
        if (this.bossActive) {
            const damage = newLevel * 10;
            this.bossHealth -= damage;
            this.showFloatingText(`-${damage}‚ù§Ô∏è`, rect.left + 50, rect.top - 60, '#ff0000');
            this.updateBoss();
        }
        const indicesToRemove = [...this.selectedItems].sort((a, b) => b - a);
        indicesToRemove.forEach(idx => this.items.splice(idx, 1));
        this.items.push({ level: newLevel });
        this.addCombo();
        this.createParticles(rect.left + 50, rect.top + 50);
        this.selectedItems = [];
        this.updateQuests('merges', 1);
        if (newLevel >= 100) this.victory();
        this.render();
    }

    buySlot() {
        if (this.coins >= this.costs.slot) {
            this.coins -= this.costs.slot;
            this.slots++;
            this.costs.slot = Math.floor(this.costs.slot * 1.5);
            this.render();
            this.showFloatingText('+1 —Å–ª–æ—Ç!', window.innerWidth/2, window.innerHeight/2, '#4ecdc4');
            this.updateQuests('slots', 1);
            this.checkAchievements();
        }
    }

    boostIncome() {
        if (this.coins >= this.costs.boost) {
            this.coins -= this.costs.boost;
            this.incomeMultiplier *= 2;
            this.costs.boost = Math.floor(this.costs.boost * 3);
            this.render();
            this.showFloatingText('–î–æ—Ö–æ–¥ x2!', window.innerWidth/2, window.innerHeight/2, '#ffd700');
        }
    }

    buyClickBoost() {
        if (this.coins >= this.costs.clickBoost) {
            this.coins -= this.costs.clickBoost;
            this.clickMultiplier *= 2;
            this.costs.clickBoost = Math.floor(this.costs.clickBoost * 4);
            this.render();
            this.showFloatingText('–ö–ª–∏–∫ x2!', window.innerWidth/2, window.innerHeight/2, '#ff6b6b');
        }
    }

    buyAutoMerge() {
        if (this.autoMergeUnlocked) return;
        if (this.coins >= this.costs.autoMerge) {
            this.coins -= this.costs.autoMerge;
            this.autoMergeUnlocked = true;
            this.startAutoMerge();
            this.showToast('ü§ñ –ê–≤—Ç–æ-—Å–ª–∏—è–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ!');
            this.unlockAchievement('automation');
        }
    }

    buyAutoClicker() {
        if (this.autoclickerUnlocked) return;
        if (this.coins >= this.costs.autoclicker) {
            this.coins -= this.costs.autoclicker;
            this.autoclickerUnlocked = true;
            document.getElementById('autoclicker-panel').style.display = 'block';
            this.render();
            this.showToast('üñ±Ô∏è –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –∫—É–ø–ª–µ–Ω!');
        }
    }

    toggleAutoClicker() {
        this.autoclickerActive = !this.autoclickerActive;
        document.getElementById('autoclicker-toggle').classList.toggle('active', this.autoclickerActive);
        this.showToast(this.autoclickerActive ? 'üñ±Ô∏è –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –í–ö–õ' : 'üñ±Ô∏è –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –í–´–ö–õ');
    }

    buyDiamonds() {
        if (this.coins >= this.costs.diamonds) {
            this.coins -= this.costs.diamonds;
            this.diamonds += 10;
            this.render();
            this.showToast('üíé +10 –∞–ª–º–∞–∑–æ–≤!');
        }
    }

    buyHighLevel() {
        if (this.coins >= this.costs.highLevel) {
            this.coins -= this.costs.highLevel;
            this.items.push({ level: this.shopLevel });
            this.shopLevel += 5;
            this.costs.highLevel = Math.floor(this.costs.highLevel * 5);
            this.render();
            this.showFloatingText(`–ö—É–ø–ª–µ–Ω ${this.shopLevel - 5} —É—Ä.!`, window.innerWidth/2, window.innerHeight/2, '#9b5de5');
        }
    }

    startAutoMerge() {
        const speedSkill = this.skills.find(s => s.id === 'speed');
        const interval = 2000 / (1 + (speedSkill ? speedSkill.level * 0.2 : 0));
        this.autoMergeInterval = setInterval(() => {
            if (this.bossActive) return;
            const levels = {};
            this.items.forEach((item, idx) => {
                if (!levels[item.level]) levels[item.level] = [];
                levels[item.level].push(idx);
            });
            for (let level in levels) {
                if (levels[level].length >= 2) {
                    this.selectedItems = levels[level].slice(0, 2);
                    this.doSuperMerge();
                    break;
                }
            }
        }, interval);
    }

    activateTurbo() {
        if (this.turboActive || this.coins < this.turboCost) {
            if (this.coins < this.turboCost) this.showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
            return;
        }
        this.coins -= this.turboCost;
        this.turboActive = true;
        this.turboCost = Math.floor(this.turboCost * 2);
        document.body.classList.add('turbo-active');
        document.getElementById('turbo-btn').disabled = true;
        if (this.autoMergeInterval) {
            clearInterval(this.autoMergeInterval);
            this.autoMergeInterval = setInterval(() => {
                if (this.bossActive) return;
                const levels = {};
                this.items.forEach((item, idx) => {
                    if (!levels[item.level]) levels[item.level] = [];
                    levels[item.level].push(idx);
                });
                for (let level in levels) {
                    if (levels[level].length >= 2) {
                        this.selectedItems = levels[level].slice(0, 2);
                        this.doSuperMerge();
                        break;
                    }
                }
            }, 500);
        }
        this.showToast('‚ö° –¢–£–†–ë–û –†–ï–ñ–ò–ú!');
        setTimeout(() => {
            this.turboActive = false;
            document.body.classList.remove('turbo-active');
            document.getElementById('turbo-btn').disabled = false;
            if (this.autoMergeInterval) {
                clearInterval(this.autoMergeInterval);
                this.startAutoMerge();
            }
            this.showToast('‚ö° –¢—É—Ä–±–æ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è');
            this.render();
        }, 30000);
        this.render();
    }

    activateGoldenMode() {
        if (this.goldenMode || this.coins < this.goldenCost) {
            if (this.coins < this.goldenCost) this.showToast('‚ùå –ù—É–∂–Ω–æ –±–æ–ª—å—à–µ –º–æ–Ω–µ—Ç!');
            return;
        }
        this.coins -= this.goldenCost;
        this.goldenMode = true;
        this.goldenCost = Math.floor(this.goldenCost * 2);
        document.getElementById('golden-cost').textContent = this.formatNumber(this.goldenCost);
        this.showToast('‚ú® –ó–û–õ–û–¢–û–ô –†–ï–ñ–ò–ú! –í—Å–µ –Ω–æ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã +—É—Ä–æ–≤–µ–Ω—å!');
        setTimeout(() => {
            this.goldenMode = false;
            this.showToast('‚ú® –ó–æ–ª–æ—Ç–æ–π —Ä–µ–∂–∏–º –æ–∫–æ–Ω—á–µ–Ω');
        }, 60000);
        this.render();
    }

    startBossFight() {
        if (this.bossActive) return;
        if (this.maxLevel < 25) {
            this.showToast('‚ùå –ù—É–∂–µ–Ω 25 —É—Ä–æ–≤–µ–Ω—å!');
            return;
        }
        this.bossActive = true;
        this.bossHealth = this.maxLevel * 100;
        this.bossMaxHealth = this.bossHealth;
        this.bossTimer = 60;
        document.getElementById('boss-panel').style.display = 'block';
        document.getElementById('boss-btn').disabled = true;
        this.bossInterval = setInterval(() => {
            this.bossTimer--;
            document.getElementById('boss-timer').textContent = this.bossTimer;
            if (this.bossTimer <= 0 || this.bossHealth <= 0) this.endBossFight();
        }, 1000);
        this.showToast('üëπ –ë–û–°–° –ü–û–Ø–í–ò–õ–°–Ø! –°–ª–∏–≤–∞–π –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è —É—Ä–æ–Ω–∞!');
    }

    updateBoss() {
        const percent = (this.bossHealth / this.bossMaxHealth) * 100;
        document.getElementById('boss-health').style.width = `${Math.max(0, percent)}%`;
        if (this.bossHealth <= 0) this.endBossFight(true);
    }

    endBossFight(victory = false) {
        clearInterval(this.bossInterval);
        this.bossActive = false;
        if (victory) {
            this.diamonds += 100;
            this.showToast('üéâ –ë–û–°–° –ü–û–ë–ï–ñ–î–Å–ù! +100 üíé');
            this.unlockAchievement('boss_slayer');
            this.createParticles(window.innerWidth/2, window.innerHeight/2);
        } else {
            document.getElementById('defeat').classList.add('active');
        }
        document.getElementById('boss-panel').style.display = 'none';
        document.getElementById('boss-btn').disabled = false;
    }

    closeDefeat() {
        document.getElementById('defeat').classList.remove('active');
    }

    doPrestige() {
        if (this.maxLevel < 50) {
            this.showToast('‚ùå –ù—É–∂–µ–Ω 50+ —É—Ä–æ–≤–µ–Ω—å!');
            return;
        }
        if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å –í–°–Å —Ä–∞–¥–∏ x2 –º–Ω–æ–∂–∏—Ç–µ–ª—è?')) return;
        this.prestigePoints++;
        this.prestigeMultiplier *= 2;
        this.coins = 10;
        this.exp = 0;
        this.maxLevel = 1;
        this.items = [];
        this.slots = 12;
        this.incomeMultiplier = 1;
        this.clickMultiplier = 1;
        this.autoMergeUnlocked = false;
        this.turboActive = false;
        this.goldenMode = false;
        this.autoclickerUnlocked = false;
        this.autoclickerActive = false;
        if (this.autoMergeInterval) clearInterval(this.autoMergeInterval);
        this.costs = { slot: 100, boost: 500, autoMerge: 1000, highLevel: 10000, clickBoost: 2000, turbo: 5000, golden: 10000, autoclicker: 50000, diamonds: 100000 };
        this.shopLevel = 5;
        this.turboCost = 5000;
        this.goldenCost = 10000;
        this.spawnInitialItems();
        this.showToast('üíé –ü—Ä–µ—Å—Ç–∏–∂! –ú–Ω–æ–∂–∏—Ç–µ–ª—å x' + this.prestigeMultiplier);
        this.unlockAchievement('prestige_master');
        this.updatePrestigeUI();
        this.render();
    }

    updatePrestigeUI() {
        if (this.prestigePoints > 0) {
            document.getElementById('prestige-box').style.display = 'block';
            document.getElementById('prestige-bonus').style.display = 'inline';
            document.getElementById('prestige-multiplier').textContent = this.prestigeMultiplier;
        }
        if (this.maxLevel >= 40) document.getElementById('prestige-panel').style.display = 'block';
    }

    renderQuests() {
        const container = document.getElementById('quests-list');
        container.innerHTML = this.quests.map(q => {
            const percent = Math.min(100, (q.current / q.target) * 100);
            return `<div class="quest ${q.completed ? 'completed' : ''}"><div class="quest-icon">üìú</div><div class="quest-info"><div class="quest-name">${q.name}</div><div>${q.desc}</div><div class="quest-bar"><div class="quest-bar-fill" style="width: ${percent}%"></div></div><div>${q.current}/${q.target}</div></div><div style="color: #ffd700; font-weight: bold;">üí∞ ${this.formatNumber(q.reward)}</div></div>`;
        }).join('');
    }

    updateQuests(type, amount) {
        this.quests.forEach(q => {
            if (q.type === type && !q.completed) {
                if (type === 'combo') q.current = Math.max(q.current, amount);
                else q.current += amount;
                if (q.current >= q.target) {
                    q.completed = true;
                    this.coins += q.reward;
                    this.showToast(`üìú –ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω: ${q.name}! +${this.formatNumber(q.reward)}üí∞`);
                }
            }
        });
        this.renderQuests();
    }

    renderSkills() {
        const container = document.getElementById('skills-grid');
        container.innerHTML = this.skills.map(s => `<div class="skill"><div class="skill-icon">${s.icon}</div><div style="font-weight: bold;">${s.name}</div><div style="font-size: 0.85em; opacity: 0.8;">${s.desc}</div><div style="color: #ff6b6b; font-weight: bold;">–£—Ä. ${s.level}/${s.maxLevel}</div><button class="btn ${s.level >= s.maxLevel ? 'disabled' : ''}" onclick="game.upgradeSkill('${s.id}')" ${s.level >= s.maxLevel ? 'disabled' : ''}>${s.level >= s.maxLevel ? 'MAX' : `üíé ${s.cost}`}</button></div>`).join('');
    }

    upgradeSkill(id) {
        const skill = this.skills.find(s => s.id === id);
        if (!skill || skill.level >= skill.maxLevel) return;
        if (this.diamonds < skill.cost) {
            this.showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤!');
            return;
        }
        this.diamonds -= skill.cost;
        skill.level++;
        skill.cost = Math.floor(skill.cost * 1.5);
        this.showToast(`‚ö° ${skill.name} +1!`);
        this.renderSkills();
        const upgradedSkills = this.skills.filter(s => s.level > 0).length;
        if (upgradedSkills >= 5) this.unlockAchievement('skill_master');
    }

    renderPets() {
        const container = document.getElementById('pets-grid');
        document.getElementById('active-pet').textContent = this.activePet ? `${this.activePet.icon} ${this.activePet.name}` : '–ù–µ—Ç';
        container.innerHTML = this.pets.map(p => `<div class="pet-item ${p.owned ? (p.active ? 'active' : '') : 'locked'}" onclick="game.togglePet('${p.id}')"><div class="pet-icon">${p.icon}</div><div>${p.name}</div><div style="font-size: 0.85em; color: #ff9500;">${p.bonus}</div><div style="color: ${p.owned ? '#00ff00' : '#00ffff'};">${p.owned ? (p.active ? '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω' : '–ù–∞–∂–º–∏') : `üíé ${p.cost}`}</div></div>`).join('');
    }

    togglePet(id) {
        const pet = this.pets.find(p => p.id === id);
        if (!pet) return;
        if (!pet.owned) {
            if (this.diamonds < pet.cost) {
                this.showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤!');
                return;
            }
            this.diamonds -= pet.cost;
            pet.owned = true;
            this.showToast(`üêæ ${pet.name} –∫—É–ø–ª–µ–Ω!`);
            this.unlockAchievement('pet_master');
        }
        this.pets.forEach(p => p.active = false);
        this.activePet = null;
        pet.active = true;
        this.activePet = pet;
        this.renderPets();
    }

    openChest(type) {
        const costs = { common: 1000, rare: 5000, epic: 10, legendary: 50 };
        const isDiamond = type === 'epic' || type === 'legendary';
        if (isDiamond) {
            if (this.diamonds < costs[type]) {
                this.showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤!');
                return;
            }
            this.diamonds -= costs[type];
        } else {
            if (this.coins < costs[type]) {
                this.showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
                return;
            }
            this.coins -= costs[type];
        }
        const rewards = {
            common: [{ type: 'coins', min: 500, max: 2000 }, { type: 'exp', min: 50, max: 200 }, { type: 'item', level: 3 }],
            rare: [{ type: 'coins', min: 3000, max: 10000 }, { type: 'exp', min: 300, max: 1000 }, { type: 'item', level: 5 }, { type: 'diamonds', min: 1, max: 5 }],
            epic: [{ type: 'coins', min: 10000, max: 50000 }, { type: 'item', level: 10 }, { type: 'diamonds', min: 5, max: 15 }, { type: 'slot', value: 1 }],
            legendary: [{ type: 'coins', min: 100000, max: 500000 }, { type: 'item', level: 25 }, { type: 'diamonds', min: 20, max: 50 }, { type: 'skin', id: 'gold' }]
        };
        const possible = rewards[type];
        const reward = possible[Math.floor(Math.random() * possible.length)];
        switch(reward.type) {
            case 'coins':
                const coins = Math.floor(Math.random() * (reward.max - reward.min) + reward.min);
                this.coins += coins;
                this.showToast(`üéÅ +${this.formatNumber(coins)} –º–æ–Ω–µ—Ç!`);
                break;
            case 'exp':
                const exp = Math.floor(Math.random() * (reward.max - reward.min) + reward.min);
                this.exp += exp;
                this.showToast(`üéÅ +${exp} –æ–ø—ã—Ç–∞!`);
                break;
            case 'item':
                this.items.push({ level: reward.level });
                this.showToast(`üéÅ –ü—Ä–µ–¥–º–µ—Ç ${reward.level} —É—Ä–æ–≤–Ω—è!`);
                break;
            case 'diamonds':
                const diamonds = Math.floor(Math.random() * (reward.max - reward.min) + reward.min);
                this.diamonds += diamonds;
                this.showToast(`üíé +${diamonds} –∞–ª–º–∞–∑–æ–≤!`);
                break;
            case 'slot':
                this.slots += reward.value;
                this.showToast(`üì¶ +${reward.value} —Å–ª–æ—Ç!`);
                break;
            case 'skin':
                const skin = this.skins.find(s => s.id === reward.id);
                if (skin) {
                    skin.unlocked = true;
                    this.showToast(`üé® –°–∫–∏–Ω "${skin.name}" —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!`);
                }
                break;
        }
        this.createParticles(window.innerWidth/2, window.innerHeight/2);
        this.render();
        this.renderSkins();
    }

    renderSkins() {
        const container = document.getElementById('skins-grid');
        container.innerHTML = this.skins.map(s => `<div class="skin-item ${s.equipped ? 'equipped' : ''} ${!s.unlocked ? 'locked' : ''}" onclick="game.equipSkin('${s.id}')"><div style="font-size: 2em;">${s.icon}</div><div>${s.name}</div><div style="color: ${s.unlocked ? '#00ff00' : '#ffd700'};">${s.unlocked ? (s.equipped ? '‚úÖ –ù–∞–¥–µ—Ç' : '–ù–∞–¥–µ—Ç—å') : `üí∞ ${s.cost}`}</div></div>`).join('');
    }

    equipSkin(id) {
        const skin = this.skins.find(s => s.id === id);
        if (!skin) return;
        if (!skin.unlocked) {
            if (this.coins < skin.cost) {
                this.showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
                return;
            }
            this.coins -= skin.cost;
            skin.unlocked = true;
            this.showToast(`üé® –°–∫–∏–Ω "${skin.name}" –∫—É–ø–ª–µ–Ω!`);
        }
        this.skins.forEach(s => s.equipped = false);
        skin.equipped = true;
        this.equippedSkin = id;
        this.renderSkins();
        this.render();
    }

    startMemoryGame() {
        if (this.memoryGame.active) return;
        const emojis = ['üçé', 'üçå', 'üçá', 'üçä', 'üçì', 'üçâ', 'ü•ù', 'üçí'];
        const cards = [...emojis, ...emojis].sort(() => Math.random() - 0.5);
        this.memoryGame = { active: true, cards: cards, flipped: [], matched: 0 };
        this.renderMemoryGame();
    }

    renderMemoryGame() {
        const container = document.getElementById('memory-grid');
        container.innerHTML = this.memoryGame.cards.map((emoji, i) => {
            const isFlipped = this.memoryGame.flipped.includes(i);
            const isMatched = this.memoryGame.matched > 0 && this.memoryGame.flipped.filter(f => this.memoryGame.cards[f] === emoji).length === 2;
            return `<div class="memory-card ${isFlipped ? 'flipped' : ''} ${isMatched ? 'matched' : ''}" onclick="game.flipCard(${i})" style="${isFlipped || isMatched ? '' : 'font-size: 0;'}">${isFlipped || isMatched ? emoji : '?'}</div>`;
        }).join('');
    }

    flipCard(index) {
        if (!this.memoryGame.active) return;
        if (this.memoryGame.flipped.includes(index)) return;
        if (this.memoryGame.flipped.length >= 2) return;
        this.memoryGame.flipped.push(index);
        this.renderMemoryGame();
        if (this.memoryGame.flipped.length === 2) {
            const [a, b] = this.memoryGame.flipped;
            if (this.memoryGame.cards[a] === this.memoryGame.cards[b]) {
                this.memoryGame.matched++;
                this.memoryGame.flipped = [];
                if (this.memoryGame.matched === 8) {
                    this.coins += 5000;
                    this.showToast('üéâ –ü–æ–±–µ–¥–∞! +5000 –º–æ–Ω–µ—Ç!');
                    this.memoryGame.active = false;
                    setTimeout(() => { document.getElementById('memory-grid').innerHTML = ''; }, 2000);
                }
            } else {
                setTimeout(() => { this.memoryGame.flipped = []; this.renderMemoryGame(); }, 1000);
            }
        }
    }

    renderDailyRewards() {
        const container = document.getElementById('daily-rewards');
        const rewards = ['üí∞', 'üíé', '‚ö°', 'üî•', '‚≠ê', 'üéÅ', 'üëë'];
        container.innerHTML = rewards.map((reward, i) => {
            let className = 'daily-item';
            if (i < this.dailyStreak % 7) className += ' claimed';
            else if (i === this.dailyStreak % 7) className += ' today';
            return `<div class="${className}"><div>${reward}</div><small>–î${i+1}</small></div>`;
        }).join('');
    }

    checkDailyReward() {
        const now = Date.now();
        const canClaim = now - this.lastDailyClaim >= 24 * 60 * 60 * 1000;
        document.getElementById('claim-daily-btn').disabled = !canClaim;
        document.getElementById('claim-daily-btn').textContent = canClaim ? 'üéÅ –ü–æ–ª—É—á–∏—Ç—å' : '‚è≥ –ó–∞–≤—Ç—Ä–∞';
    }

    claimDaily() {
        const now = Date.now();
        if (now - this.lastDailyClaim < 24 * 60 * 60 * 1000) return;
        if (now - this.lastDailyClaim < 48 * 60 * 60 * 1000) this.dailyStreak++;
        else this.dailyStreak = 1;
        this.lastDailyClaim = now;
        const day = (this.dailyStreak - 1) % 7;
        const rewards = [{ coins: 100 }, { coins: 250 }, { coins: 500, exp: 100 }, { coins: 1000, item: 3 }, { coins: 2000, exp: 500 }, { coins: 5000, item: 5 }, { coins: 10000, exp: 1000, item: 10, diamonds: 10 }];
        const reward = rewards[day];
        if (reward.coins) {
            this.coins += reward.coins;
            this.showFloatingText(`+${reward.coins}üí∞`, window.innerWidth/2, window.innerHeight/2, '#ffd700');
        }
        if (reward.exp) {
            this.exp += reward.exp;
            this.showFloatingText(`+${reward.exp}‚≠ê`, window.innerWidth/2, window.innerHeight/2 - 30, '#4ecdc4');
        }
        if (reward.item) {
            this.items.push({ level: reward.item });
            this.showFloatingText(`+${reward.item} —É—Ä!`, window.innerWidth/2, window.innerHeight/2 - 60, '#ff6b6b');
        }
        if (reward.diamonds) {
            this.diamonds += reward.diamonds;
            this.showFloatingText(`+${reward.diamonds}üíé`, window.innerWidth/2, window.innerHeight/2 - 90, '#00ffff');
        }
        this.showToast(`üéÅ –î–µ–Ω—å ${this.dailyStreak}!`);
        this.renderDailyRewards();
        this.checkDailyReward();
        this.render();
    }

    spinWheel() {
        if (this.coins < 1000) {
            this.showToast('‚ùå –ù—É–∂–Ω–æ 1000 –º–æ–Ω–µ—Ç!');
            return;
        }
        this.coins -= 1000;
        document.getElementById('spin-btn').disabled = true;
        const wheel = document.getElementById('wheel');
        const degrees = (5 + Math.random() * 5) * 360 + Math.random() * 360;
        wheel.style.transform = `rotate(${degrees}deg)`;
        setTimeout(() => {
            const result = Math.floor((degrees % 360) / 45);
            this.processWheelResult(result);
            document.getElementById('spin-btn').disabled = false;
        }, 4000);
    }

    processWheelResult(segment) {
        const prizes = [
            { type: 'coins', value: 5000, text: '5000üí∞' },
            { type: 'exp', value: 1000, text: '1000‚≠ê' },
            { type: 'item', value: 10, text: '–ü—Ä–µ–¥–º–µ—Ç 10!' },
            { type: 'coins', value: 10000, text: '10000üí∞' },
            { type: 'slot', value: 1, text: '+1 —Å–ª–æ—Ç!' },
            { type: 'coins', value: 2000, text: '2000üí∞' },
            { type: 'diamonds', value: 5, text: '5üíé' },
            { type: 'jackpot', value: 50000, text: '–î–ñ–ï–ö–ü–û–¢ 50000!' }
        ];
        const prize = prizes[segment];
        switch(prize.type) {
            case 'coins': this.coins += prize.value; break;
            case 'exp': this.exp += prize.value; break;
            case 'item': this.items.push({ level: prize.value }); break;
            case 'slot': this.slots++; break;
            case 'diamonds': this.diamonds += prize.value; break;
            case 'jackpot': this.coins += prize.value; this.unlockAchievement('lucky'); break;
        }
        this.showToast(`üé∞ ${prize.text}`);
        this.createParticles(window.innerWidth/2, window.innerHeight/2);
        this.render();
    }

    victory() {
        document.getElementById('final-score').textContent = this.formatNumber(this.coins);
        document.getElementById('victory').classList.add('active');
        this.createFireworks();
    }

    continueGame() {
        document.getElementById('victory').classList.remove('active');
    }

    checkAchievements() {
        const checks = [
            { id: 'level_10', condition: this.maxLevel >= 10 },
            { id: 'level_25', condition: this.maxLevel >= 25 },
            { id: 'level_50', condition: this.maxLevel >= 50 },
            { id: 'level_75', condition: this.maxLevel >= 75 },
            { id: 'rich', condition: this.coins >= 1000000 },
            { id: 'collector', condition: this.slots >= 22 }
        ];
        checks.forEach(check => { if (check.condition) this.unlockAchievement(check.id); });
    }

    unlockAchievement(id) {
        const ach = this.achievements.find(a => a.id === id);
        if (ach && !ach.unlocked) {
            ach.unlocked = true;
            this.renderAchievements();
            this.showToast(`üèÖ ${ach.name}!`);
        }
    }

    renderAchievements() {
        const container = document.getElementById('achievements-list');
        container.innerHTML = this.achievements.map(ach => `<div class="achievement ${ach.unlocked ? 'unlocked' : ''}"><div class="achievement-icon">${ach.icon}</div><div class="achievement-info"><div class="achievement-name">${ach.name}</div><div class="achievement-desc">${ach.desc}</div></div><div>${ach.unlocked ? '‚úÖ' : 'üîí'}</div></div>`).join('');
    }

    updateStats() {
        document.getElementById('stat-merges').textContent = this.formatNumber(this.totalMerges);
        document.getElementById('stat-time').textContent = this.formatTime(this.playTime);
        document.getElementById('stat-earned').textContent = this.formatNumber(this.totalEarned);
        document.getElementById('stat-max-combo').textContent = this.maxCombo;
    }

    showTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
        document.getElementById(`tab-${tabName}`).classList.add('active');
        event.target.classList.add('active');
    }

    toggleTheme() {
        this.lightTheme = !this.lightTheme;
        document.body.classList.toggle('light-theme', this.lightTheme);
        document.querySelectorAll('.settings-btn')[1].textContent = this.lightTheme ? '‚òÄÔ∏è' : 'üåô';
    }

    showExportModal() {
        document.getElementById('export-modal').classList.add('active');
    }

    closeModal() {
        document.getElementById('export-modal').classList.remove('active');
    }

    exportSave() {
        const data = {
            coins: this.coins, diamonds: this.diamonds, exp: this.exp, maxLevel: this.maxLevel,
            items: this.items, slots: this.slots, incomeMultiplier: this.incomeMultiplier,
            clickMultiplier: this.clickMultiplier, autoMergeUnlocked: this.autoMergeUnlocked,
            costs: this.costs, shopLevel: this.shopLevel, prestigePoints: this.prestigePoints,
            prestigeMultiplier: this.prestigeMultiplier, achievements: this.achievements,
            totalMerges: this.totalMerges, totalEarned: this.totalEarned, playTime: this.playTime,
            maxCombo: this.maxCombo, dailyStreak: this.dailyStreak, lastDailyClaim: this.lastDailyClaim,
            skills: this.skills, pets: this.pets, skins: this.skins, equippedSkin: this.equippedSkin,
            playerLevel: this.playerLevel, playerXP: this.playerXP, playerXPRequired: this.playerXPRequired,
            quests: this.quests, autoclickerUnlocked: this.autoclickerUnlocked
        };
        document.getElementById('save-code').value = btoa(JSON.stringify(data));
        this.showToast('üì§ –ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
    }

    importSave() {
        try {
            const code = document.getElementById('save-code').value.trim();
            if (!code) return;
            const data = JSON.parse(atob(code));
            Object.assign(this, data);
            if (this.autoMergeUnlocked) this.startAutoMerge();
            this.closeModal();
            this.showToast('üì• –ó–∞–≥—Ä—É–∂–µ–Ω–æ!');
            this.render();
            this.renderQuests();
            this.renderSkills();
            this.renderPets();
            this.renderSkins();
            this.renderDailyRewards();
            this.checkDailyReward();
            this.updatePlayerLevel();
            if (this.autoclickerUnlocked) document.getElementById('autoclicker-panel').style.display = 'block';
        } catch (e) {
            this.showToast('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!');
        }
    }

    resetGame() {
        if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å –í–°–Å –ø—Ä–æ–≥—Ä–µ—Å—Å?')) return;
        localStorage.removeItem('merge100_save');
        location.reload();
    }

    saveGame() {
        const data = {
            coins: this.coins, diamonds: this.diamonds, exp: this.exp, maxLevel: this.maxLevel,
            items: this.items, slots: this.slots, incomeMultiplier: this.incomeMultiplier,
            clickMultiplier: this.clickMultiplier, autoMergeUnlocked: this.autoMergeUnlocked,
            costs: this.costs, shopLevel: this.shopLevel, prestigePoints: this.prestigePoints,
            prestigeMultiplier: this.prestigeMultiplier, achievements: this.achievements,
            totalMerges: this.totalMerges, totalEarned: this.totalEarned, playTime: this.playTime,
            maxCombo: this.maxCombo, dailyStreak: this.dailyStreak, lastDailyClaim: this.lastDailyClaim,
            lastSaveTime: Date.now(), skills: this.skills, pets: this.pets, skins: this.skins,
            equippedSkin: this.equippedSkin, playerLevel: this.playerLevel, playerXP: this.playerXP,
            playerXPRequired: this.playerXPRequired, quests: this.quests, autoclickerUnlocked: this.autoclickerUnlocked
        };
        localStorage.setItem('merge100_save', JSON.stringify(data));
    }

    loadGame() {
        const saved = localStorage.getItem('merge100_save');
        if (saved) {
            const data = JSON.parse(saved);
            Object.assign(this, data);
            if (this.autoMergeUnlocked) this.startAutoMerge();
            if (this.autoclickerUnlocked) document.getElementById('autoclicker-panel').style.display = 'block';
        }
    }

    toggleSound() {
        this.soundEnabled = !this.soundEnabled;
        document.querySelectorAll('.settings-btn')[0].textContent = this.soundEnabled ? 'üîä' : 'üîá';
    }

    showFloatingText(text, x, y, color) {
        const el = document.createElement('div');
        el.className = 'floating-text';
        el.textContent = text;
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        el.style.color = color;
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 1000);
    }

    showToast(message) {
        const existing = document.querySelector('.toast');
        if (existing) existing.remove();
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }

    createParticles(x, y) {
        for (let i = 0; i < 20; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            particle.style.setProperty('--tx', (Math.random() - 0.5) * 200 + 'px');
            particle.style.setProperty('--ty', (Math.random() - 0.5) * 200 + 'px');
            particle.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), 1000);
        }
    }

    createFireworks() {
        setInterval(() => {
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight;
            this.createParticles(x, y);
        }, 500);
    }

    updateUI() {
        document.getElementById('coins').textContent = this.formatNumber(this.coins);
        document.getElementById('diamonds').textContent = this.diamonds;
        document.getElementById('exp').textContent = this.formatNumber(this.exp);
        document.getElementById('max-level').textContent = this.maxLevel;
        document.getElementById('prestige-points').textContent = this.prestigePoints;
        document.getElementById('income-display').textContent = this.formatNumber(this.getIncome());
        document.getElementById('turbo-cost').textContent = this.formatNumber(this.turboCost);
        document.getElementById('golden-cost').textContent = this.formatNumber(this.goldenCost);
        const diamondIncome = 1 + (this.skills.find(s => s.id === 'diamond')?.level || 0);
        document.getElementById('diamond-income').textContent = this.activePet?.id === 'unicorn' ? diamondIncome * 2 : diamondIncome;
        document.getElementById('slot-cost').textContent = this.formatNumber(this.costs.slot);
        document.getElementById('boost-cost').textContent = this.formatNumber(this.costs.boost);
        document.getElementById('auto-merge-cost').textContent = this.autoMergeUnlocked ? '‚úÖ' : this.formatNumber(this.costs.autoMerge);
        document.getElementById('high-level-cost').textContent = this.formatNumber(this.costs.highLevel);
        document.getElementById('click-cost').textContent = this.formatNumber(this.costs.clickBoost);
        document.getElementById('autoclick-cost').textContent = this.formatNumber(this.costs.autoclicker);
        document.getElementById('diamond-buy-cost').textContent = this.formatNumber(this.costs.diamonds);
        document.getElementById('shop-level').textContent = this.shopLevel;
        this.updatePrestigeUI();
    }

    render() {
        this.updateUI();
        const container = document.getElementById('game-area');
        container.innerHTML = '';
        this.items.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = `item ${item.golden ? 'golden' : ''}`;
            if (this.selectedItems.includes(index)) div.classList.add('selected');
            if (item.level >= 100) div.classList.add('max-level');
            div.style.background = this.getItemColor(item.level);
            div.dataset.index = index;
            div.innerHTML = `<div class="item-icon">${this.getItemEmoji(item.level)}</div><div class="item-level">${item.level}</div>`;
            div.onclick = () => this.selectItem(index);
            container.appendChild(div);
        });
        for (let i = this.items.length; i < this.slots; i++) {
            const div = document.createElement('div');
            div.className = 'item';
            div.style.background = 'rgba(255,255,255,0.05)';
            div.style.border = '2px dashed rgba(255,255,255,0.2)';
            div.style.cursor = 'default';
            div.innerHTML = '<div style="opacity: 0.3; font-size: 2em;">+</div>';
            container.appendChild(div);
        }
    }
}

const game = new Game();
window.addEventListener('beforeunload', () => { game.saveGame(); });
</script>
</body>
</html>
'''
